---
type Subject = {
  id: number;
  name: string;
  name_cn?: string;
};

type WatchingItem = {
  subject: Subject;
};

const username = "851657"; // ä½ çš„ bangumi ç”¨æˆ· ID
const apiUrl = `https://api.bgm.tv/v0/users/${username}/collections?type=3`;

let watching: WatchingItem[] = [];

try {
  const res = await fetch(apiUrl, {
    headers: {
      "User-Agent": "AstroBlog/1.0 (https://yourblog.com)",
    },
  });
  if (res.ok) {
    const data = await res.json();
    watching = data.data ?? [];
  } else {
    console.error("Bangumi API è¯·æ±‚å¤±è´¥:", res.status);
  }
} catch (err) {
  console.error("Bangumi API é”™è¯¯:", err);
}
---

<html lang="zh">
  <head>
    <title>æˆ‘çš„è¿½ç•ª</title>
    <meta charset="UTF-8" />
  </head>
  <body>
    <h1>ğŸ“º æˆ‘çš„è¿½ç•ª</h1>

    {
      watching.length === 0 ? (
        <p>ç›®å‰æ²¡æœ‰åœ¨è¿½çš„ç•ªå‰§</p>
      ) : (
        <ul>
          {watching.map((item: WatchingItem) => (
            <li>
              <a href={`https://bgm.tv/subject/${item.subject.id}`} target="_blank">
                {item.subject.name_cn || item.subject.name}
              </a>
            </li>
          ))}
        </ul>
      )
    }
  </body>
</html>
