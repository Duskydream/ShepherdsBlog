/* Use postcss-nesting */
@tailwind base;
@tailwind components;
@tailwind utilities;

/* Color scheme configuration to prevent Chrome's auto dark theme */
:root,
[data-theme-type="light"] {
  color-scheme: light dark; /* This prevents Chrome's auto dark theme from taking effect */
}

[data-theme-type="dark"] {
  color-scheme: dark;
}

/* Global styles with nesting support */
html {
  @apply scroll-smooth;
}

/* Global image citation blocks - only for content images */
.prose {
  /* Ensure prose containers don't clip content */
  overflow: visible !important;
}

.prose img {
  /* Gray citation block below each image - like markdown quote */
  &::after {
    content: "" !important;
    display: block !important;
    width: 120% !important;
    height: 16px !important;
    background-color: #e5e7eb !important;
    border: 2px solid #d1d5db !important;
    margin-top: 8px !important;
    border-radius: 4px !important;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1) !important;
  }
}

kbd {
  @apply kbd;
}

code {
  font-size: 0.875em;
}

/* Enhanced reading experience - Feishu Style */
.prose {
  /* Improved line height for better readability */
  @apply leading-relaxed;
  font-size: 16px;
  color: var(--fallback-bc, oklch(var(--bc)));
  overflow-wrap: anywhere;
  word-break: break-word;


/* Extra wrapping for long lines in blog posts */
.post-content {
  overflow-wrap: anywhere;
  word-break: break-all;
}
  /* Better paragraph spacing */
  p {
    @apply mb-4;
    line-height: 1.7;
    overflow-wrap: anywhere;
    word-break: break-word;
  }

  /* Optimized heading spacing - Feishu style */
  h1,
  h2,
  h3,
  h4,
  h5,
  h6 {
    @apply font-semibold mt-8 mb-4;
    letter-spacing: -0.01em;
    line-height: 1.4;
  }

  h1 {
    @apply text-3xl md:text-4xl;
  }

  h2 {
    @apply text-2xl md:text-3xl;
  }

  h3 {
    @apply text-xl md:text-2xl;
  }

  /* Better list spacing */
  ul,
  ol {
    @apply my-4 space-y-2;

    li {
      @apply leading-7;
      overflow-wrap: anywhere;
      word-break: break-word;
    }
  }

  /* Improved blockquote styling - Feishu style */
  blockquote {
    @apply my-6 py-3 px-5 border-l-4 border-primary/40 bg-base-200/30;
    font-style: normal;
    overflow-wrap: anywhere;
    word-break: break-word;

    p {
      @apply mb-0 leading-7 text-base-content/90;
    }
  }

  /* Better code block contrast */
  pre {
    @apply my-6 p-4 bg-base-200;
    border-radius: 8px;
  }

  /* Inline code improvements - Feishu style */
  :not(pre) > code {
    @apply px-2 py-1 bg-base-200 text-base-content font-mono;
    font-size: 0.9em;
    border-radius: 4px;
    white-space: break-spaces;
    overflow-wrap: anywhere;
    word-break: break-all;
  }

  /* Image styling */
  img {
    @apply transition-opacity duration-500;
    border-radius: 8px;
    display: block;
    margin: 1rem 0;
    max-width: min(100%, 600px);
    height: auto;
    width: auto;

    &[loading="lazy"] {
      opacity: 0;

      &.loaded {
        opacity: 1;
      }
    }

    /* Gray citation block below each image - like markdown quote */
    &::after {
      content: "引用";
      display: block;
      width: 100%;
      height: 24px;
      background-color: #6b7280 !important;
      border-left: 3px solid #d1d5db;
      margin-top: 0.75rem;
      border-radius: 0 4px 4px 0;
      box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.05);
      color: white;
      text-align: center;
      font-size: 12px;
      line-height: 24px;
      font-weight: bold;
    }
  }

  /* Table improvements - Feishu style */
  table {
    @apply my-6 w-full;
    border-collapse: collapse;

    th {
      @apply bg-base-200 font-semibold text-left py-3 px-4 border-b-2 border-base-300;
    }

    td {
      @apply py-3 px-4 border-b border-base-300;
    }

    tr:hover {
      @apply bg-base-200/50;
    }
  }

  /* Link hover effects */
  a {
    @apply text-primary transition-colors duration-200;
    overflow-wrap: anywhere;
    word-break: break-word;

    &:hover {
      @apply text-primary underline decoration-2 underline-offset-4;
    }
  }
}

.scrollbar-none {
  -ms-overflow-style: none; /* IE and Edge */
  scrollbar-width: none; /* Firefox */
  &::-webkit-scrollbar {
    display: none; /* Chrome, Safari and Opera */
  }
}

.frosti-heading {
  @apply text-2xl leading-normal pt-0 font-bold text-base-content;
}

.btn-category {
  @apply bg-primary/5 hover:bg-primary text-primary hover:text-primary-content border-none hover:scale-110;
}

.btn-tag {
  @apply bg-secondary/5 hover:bg-secondary text-secondary hover:text-secondary-content border-none hover:scale-110;
}

.btn-copy {
  @apply px-1 text-base-content/80;
}

.frosti-code {
  @apply relative my-6 bg-gray-50 border border-gray-200 rounded-lg overflow-hidden shadow-sm;
  font-family: "JetBrains Mono", "Fira Code", "Consolas", "Monaco", "Courier New", monospace !important;

  &-toolbar {
    @apply flex justify-between items-center px-4 py-3 bg-gray-100 border-b border-gray-200;
    &-language {
      @apply text-xs font-medium text-gray-600 uppercase tracking-wide;
    }
  }

  &-content {
    @apply overflow-x-auto p-4 bg-white;

    pre {
      @apply bg-transparent m-0 p-0;
      counter-reset: line;
      font-family: inherit !important;
      font-size: 14px !important;
      line-height: 1.5 !important;
    }

    .line {
      counter-increment: line;
      padding-left: 1rem;

      &::before {
        content: counter(line);
        @apply text-gray-400 mr-4 inline-block w-6 text-right text-xs select-none;
        font-family: inherit !important;
      }
    }
  }
}

// Shared components and styles for blog pages
// ===================================================

// Footnotes styles
// ---------------------------------------------------
.footnotes {
  @apply mt-12 p-6 bg-base-200/50 border border-base-content/20;

  // Footnote list item
  li {
    @apply text-sm text-base-content/80 relative;
  }
}

// Animation keyframes
@keyframes fadeIn {
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

// Common container for blog pages
.blog-container {
  @apply p-4 rounded-2xl bg-base-200/30 backdrop-blur-md border border-base-300/20;
}

// Common stats box
.stats-box {
  @apply stats shadow mb-8 w-full bg-base-200/50 backdrop-blur-sm border border-base-content/20;

  .stat-figure {
    @apply text-primary;

    svg {
      @apply w-8 h-8;
    }
  }

  .stat-value {
    @apply text-primary;
  }
}

// Empty state component
.empty {
  &-state {
    @apply flex flex-col items-center justify-center min-h-[200px] p-8 text-center text-base-content/60 bg-base-100/50 rounded-xl border border-dashed border-base-300/20;
  }

  &-icon {
    @apply w-12 h-12 opacity-60 mb-4;
  }

  &-text {
    @apply text-lg;
  }
}

// Categories Page Components
// ===================================================

// Category component styles
.categories {
  &-container {
    @extend .blog-container;
  }

  &-grid {
    @apply grid gap-6;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
  }
}

// Category card component
.category {
  &-card {
    @apply opacity-0 translate-y-5;
    animation: fadeIn 0.8s ease-out forwards;

    // Generate animation delays
    @for $i from 0 through 100 {
      &[data-index="#{$i}"] {
        animation-delay: #{0.1 + ($i * 0.05)}s;
      }
    }
  }

  &-inner {
    @apply rounded-2xl overflow-hidden bg-base-100 shadow-md border border-base-300/20 transition-transform duration-300 ease-in-out;

    &:hover {
      @apply -translate-y-1 shadow-lg;
    }

    &.expanded {
      @apply shadow-xl;
    }
  }

  &-header {
    @apply p-4 cursor-pointer flex justify-between items-center;
  }

  &-title {
    @apply flex items-center gap-3;

    h2 {
      @apply text-lg font-semibold m-0;
    }
  }

  &-icon {
    @apply flex items-center justify-center w-10 h-10 rounded-full flex-shrink-0;

    svg {
      @apply w-5 h-5;
    }
  }

  &-count {
    @apply inline-flex items-center justify-center min-w-6 h-6 px-2 rounded-full text-xs font-bold;
  }

  &-divider {
    @apply h-px bg-base-300/50 mx-4;
  }

  &-content {
    @apply max-h-0 overflow-y-auto;
    transition: max-height 0.8s;
  }
}

// Toggle button
.toggle {
  &-btn {
    @apply bg-transparent border-none cursor-pointer p-1 flex items-center justify-center text-base-content/70;
  }

  &-icon {
    @apply w-6 h-6 transition-transform duration-500;
  }
}

// Post list
.post {
  &-list {
    @apply list-none p-4 m-0 bg-base-100/70;
  }

  &-item {
    @apply mb-2;

    &:last-child {
      @apply mb-0;
    }
  }

  &-link {
    @apply flex justify-between items-center p-3 rounded-lg bg-base-200/50 transition-transform;

    &:hover {
      @apply bg-base-200 translate-x-1;

      .post-title {
        @apply text-primary;
      }
    }
  }

  &-title {
    @apply font-medium overflow-hidden text-ellipsis whitespace-nowrap text-base-content/90;
  }

  &-date {
    @apply text-xs text-base-content/60 whitespace-nowrap py-1 px-2 rounded-full bg-base-300/30;
  }
}

// Mixin for creating category color variants
@mixin category-color-variant($color-var) {
  .category-#{$color-var} {
    .category-header {
      background: linear-gradient(120deg, oklch(var(--#{$color-var}) / 0.1), oklch(var(--#{$color-var}) / 0.05));
    }

    .category-icon {
      background-color: oklch(var(--#{$color-var}) / 0.15);
      color: oklch(var(--#{$color-var}));
    }

    .category-count {
      background-color: oklch(var(--#{$color-var}) / 0.15);
      color: oklch(var(--#{$color-var}));
    }

    &.expanded {
      border-color: oklch(var(--#{$color-var}) / 0.3);
    }
  }
}

// Apply color variants
@include category-color-variant("p");
@include category-color-variant("s");
@include category-color-variant("a");
@include category-color-variant("in");
@include category-color-variant("su");
@include category-color-variant("wa");
@include category-color-variant("er");

// Rename for clarity in the component
.category-primary {
  @extend .category-p;
}
.category-secondary {
  @extend .category-s;
}
.category-accent {
  @extend .category-a;
}
.category-info {
  @extend .category-in;
}
.category-success {
  @extend .category-su;
}
.category-warning {
  @extend .category-wa;
}
.category-error {
  @extend .category-er;
}

// Tags Page Components
// ===================================================

.tags {
  &-container {
    @extend .blog-container;
  }

  &-cloud {
    @apply flex flex-wrap justify-center gap-3 min-h-[200px];
  }

  &-item {
    @apply relative opacity-0 translate-y-2 inline-flex items-center gap-2 rounded-full;
    animation: fadeIn 0.8s ease-out forwards;

    // Height fix - improved tag height
    @apply h-auto py-0;

    // Apply staggered animation with loop
    @for $i from 0 through 100 {
      &[data-index="#{$i}"] {
        animation-delay: #{0.05 + ($i * 0.02)}s;
      }
    }
  }

  &-content {
    @apply flex items-center gap-2 px-4 py-2 rounded-full bg-base-100 shadow-sm border border-transparent;
  }

  &-icon {
    @apply w-4 h-4 flex-shrink-0;
  }

  &-count {
    @apply inline-flex items-center justify-center min-w-6 h-6 px-2 text-xs font-bold rounded-full bg-base-300/30 text-base-content/80 duration-300;
  }
}

// Tag color variants
.tag {
  &-high {
    .tags-content {
      @apply border-primary/20 bg-base-100 text-primary;
    }
    .tags-icon {
      @apply text-primary;
    }
  }

  &-medium-high {
    .tags-content {
      @apply border-secondary/20 bg-base-100 text-secondary;
    }
    .tags-icon {
      @apply text-secondary;
    }
  }

  &-medium {
    .tags-content {
      @apply border-accent/20 bg-base-100 text-accent;
    }
    .tags-icon {
      @apply text-accent;
    }
  }

  &-medium-low {
    .tags-content {
      @apply border-base-content/20 bg-base-100;
    }
    .tags-icon {
      @apply text-base-content/80;
    }
  }

  &-low {
    .tags-content {
      @apply border-base-300/20 bg-base-100;
    }
    .tags-icon {
      @apply text-base-content/60;
    }
  }
}

// Archives Page Components
// ===================================================

.archives {
  &-container {
    @extend .blog-container;
  }

  &-timeline {
    @apply relative pl-8 ml-4;

    &::before {
      content: "";
      @apply absolute top-0 bottom-0 left-1 w-1 rounded bg-gradient-to-b from-primary to-secondary;
    }
  }
}

.timeline {
  &-year {
    @apply relative mb-12;

    &:last-child {
      @apply mb-0;
    }
  }

  &-month {
    @apply mb-10 relative;

    &:last-child {
      @apply mb-0;
    }
  }
}

.year {
  &-header {
    @apply relative mb-6;
  }

  &-badge {
    @apply relative -left-12 bg-primary text-primary-content font-bold text-lg py-2 px-4 rounded-full inline-block shadow-md z-10;
  }

  &-content {
    @apply relative;
  }
}

.month {
  &-title {
    @apply flex items-center gap-2 text-xl font-semibold mb-5 text-secondary pb-2 border-b border-base-content/20;
  }

  &-icon {
    @apply w-5 h-5;
  }

  &-count {
    @apply inline-flex items-center justify-center bg-secondary text-secondary-content text-xs font-bold min-w-6 h-6 rounded-full px-2 ml-2;
  }
}

.archive {
  &-posts {
    @apply list-none p-0 m-0 relative;
  }

  &-item {
    @apply relative mb-4 pl-6 flex flex-col;

    &:last-child {
      @apply mb-0;
    }
  }

  &-marker {
    @apply absolute -left-2 top-4 w-8 h-8 flex items-center justify-center bg-base-100 border-2 border-primary rounded-full z-10;
  }

  &-icon {
    @apply w-4 h-4 text-primary;
  }

  &-card {
    @apply block p-5 bg-base-100 border border-base-content/20 rounded-xl shadow-sm transition-transform duration-300;

    &:hover {
      @apply -translate-y-1 shadow-md border-primary/50 bg-base-200;

      .archive-title {
        @apply text-primary;
      }
    }
  }

  &-date {
    @apply text-sm text-base-content/60 mb-1;
  }

  &-title {
    @apply font-semibold mt-1 text-base-content line-clamp-2;
  }

  &-description {
    @apply text-sm text-base-content/70 mt-2 line-clamp-2;
  }
}

// Responsive styles for all pages
@media (max-width: 768px) {
  .blog-container {
    @apply p-3;
  }

  // Categories responsive
  .categories-grid {
    @apply grid-cols-1 gap-4;
  }

  .category-header {
    @apply py-3 px-4;
  }

  .category-icon {
    @apply w-8 h-8;

    svg {
      @apply w-4 h-4;
    }
  }

  // Tags responsive
  .tags-cloud {
    @apply gap-2;
  }

  .tags-content {
    @apply px-3 py-1.5;
  }

  // Archives responsive
  .archives-timeline {
    @apply pl-6 ml-0;
  }

  .year-badge {
    @apply -left-10 text-base py-1.5 px-3;
  }

  .archive-card {
    @apply p-4;
  }

  .archive-marker {
    @apply w-7 h-7 -left-2;
  }

  .archive-icon {
    @apply w-3.5 h-3.5;
  }
}

@media (max-width: 480px) {
  .blog-container {
    @apply p-2;
  }

  // Categories responsive
  .category-title h2 {
    @apply text-base;
  }

  .post-link {
    @apply py-2 px-3 flex-col items-start gap-1;
  }

  .post-date {
    @apply self-start;
  }

  // Tags responsive
  .tags-item {
    // Fixed height for small screens
    font-size: 0.9rem !important;
  }

  .tags-icon {
    @apply w-3.5 h-3.5;
  }

  .tags-count {
    @apply min-w-5 h-5 text-[0.65rem];
  }

  // Archives responsive
  .archives-timeline {
    @apply pl-5;
  }

  .year-badge {
    @apply -left-9 text-sm py-1 px-2.5;
  }

  .month-title {
    @apply text-lg;
  }
}

/* Pagefind UI customization with oklch colors */
#pagefind-search {
  --pagefind-ui-scale: 1;
  --pagefind-ui-primary: oklch(var(--a));
  --pagefind-ui-text: oklch(var(--bc));
  --pagefind-ui-background: oklch(var(--b1));
  --pagefind-ui-border: oklch(var(--bc) / 0.2);
  --pagefind-ui-tag: oklch(var(--b2));
  --pagefind-ui-border-width: 1px;
  --pagefind-ui-border-radius: 0.5rem;
  --pagefind-ui-image-border-radius: 0.5rem;
  --pagefind-ui-image-box-ratio: 3/2;
  --pagefind-ui-font: var(--font-sans, system-ui, sans-serif);

  .pagefind-ui__form::before {
    top: 50%;
    transform: translateY(-50%);
    left: 1rem;
  }

  .pagefind-ui__search-input {
    @apply input input-bordered w-full;
    border: 1px solid oklch(var(--bc) / 0.2);
    padding-left: 2.75rem;
  }

  .pagefind-ui__search-clear {
    @apply hidden;
  }

  .pagefind-ui__result {
    @apply p-4 border rounded-lg mb-4;
    border: 1px solid var(--pagefind-ui-border);
  }

  .pagefind-ui__result-title {
    @apply text-lg font-bold mb-2;
  }

  .pagefind-ui__result-link {
    @apply text-primary hover:underline;
  }

  .pagefind-ui__result-excerpt {
    @apply text-sm text-base-content opacity-75;
  }

  .pagefind-ui__result-excerpt mark {
    @apply bg-accent text-accent-content px-1 rounded;
  }

  .pagefind-ui__button {
    @apply btn btn-primary;
  }

  .pagefind-ui__message {
    @apply text-sm text-base-content opacity-75 my-4;
  }

  .pagefind-ui__message:empty::before {
    content: "No results found. Try a different search term.";
    @apply block text-center py-8 text-base-content opacity-50;
  }
}
/* Notion-like monochrome theme overrides */
html[data-theme="notion"] {
  /* Base colors */
  --base-100: #ffffff;
  --base-200: #f6f6f6;
  --base-300: #efefef;
  --base-content: #0f1720; /* dark text */
  --primary: #0f1720;
  --secondary: #6b7280;
  --accent: #0f1720;
  --border: #e5e7eb;
  --bc: #e5e7eb;

  /* Typography */
  font-family:
    "IBM Plex Sans",
    "Segoe UI",
    -apple-system,
    sans-serif;
}

html[data-theme="notion"] a {
  color: #0f1720;
  text-decoration-color: transparent;
  transition: color 0.15s ease;
}

html[data-theme="notion"] a:hover {
  text-decoration-color: #0f1720;
}

html[data-theme="notion"] .btn,
html[data-theme="notion"] .badge {
  background: transparent;
  border-color: var(--border);
  color: var(--base-content);
}

html[data-theme="notion"] body {
  background: #ffffff;
  color: var(--base-content);
}

html[data-theme="notion"] .notion-surface {
  background: #ffffff;
  border: 1px solid #e5e7eb;
  box-shadow: none;
}

html[data-theme="notion"] .card,
html[data-theme="notion"] .btn,
html[data-theme="notion"] .badge,
html[data-theme="notion"] .input,
html[data-theme="notion"] .textarea,
html[data-theme="notion"] .select {
  border-radius: 6px;
  box-shadow: none;
}

html[data-theme="notion"] .card {
  border: 1px solid #e5e7eb;
  background: #ffffff;
}

html[data-theme="notion"] .btn {
  border: 1px solid #e5e7eb;
  background: #ffffff;
  color: #0f1720;
}

html[data-theme="notion"] .btn-primary {
  background: #0f1720;
  border-color: #0f1720;
  color: #ffffff;
}

html[data-theme="notion"] .btn-ghost,
html[data-theme="notion"] .btn-outline {
  background: transparent;
}

html[data-theme="notion"] .badge {
  background: #f3f4f6;
  border-color: #e5e7eb;
  color: #374151;
}

html[data-theme="notion"] .shadow,
html[data-theme="notion"] .shadow-sm,
html[data-theme="notion"] .shadow-md,
html[data-theme="notion"] .shadow-lg,
html[data-theme="notion"] .shadow-xl,
html[data-theme="notion"] .shadow-2xl {
  box-shadow: none !important;
}

html[data-theme="notion"] .prose {
  color: #0f1720;
}

html[data-theme="notion"] .prose h1,
html[data-theme="notion"] .prose h2,
html[data-theme="notion"] .prose h3,
html[data-theme="notion"] .prose h4,
html[data-theme="notion"] .prose h5,
html[data-theme="notion"] .prose h6 {
  font-weight: 600;
  letter-spacing: -0.01em;
}

html[data-theme="notion"] .prose blockquote {
  border-left: 3px solid #e5e7eb;
  background: transparent;
  padding-left: 1rem;
}

html[data-theme="notion"] .prose pre {
  background: #f7f7f5;
  border: 1px solid #e5e7eb;
  border-radius: 6px;
}

html[data-theme="notion"] .prose :not(pre) > code {
  background: #f3f3f1;
  border-radius: 4px;
}

html[data-theme="notion"] .prose img {
  border-radius: 0;
}

html[data-theme="notion"] .prose img::after,
html[data-theme="notion"] .doc-content img::after {
  content: none !important;
  display: none !important;
}

/* Make cards and surfaces subtle */
html[data-theme="notion"] .bg-base-100 {
  background: var(--base-100) !important;
}

html[data-theme="notion"] .shadow-md,
html[data-theme="notion"] .shadow-lg {
  box-shadow:
    0 1px 0 rgba(15, 23, 32, 0.04),
    0 0 0 1px rgba(15, 23, 32, 0.02) !important;
}

/* Prose/detail adjustments */
html[data-theme="notion"] .text-base-content\/70 {
  color: rgb(33 33 33 / 0.7) !important;
}

html[data-theme="notion"] .divider {
  border-color: var(--border) !important;
}

/* Notion-like code block tweaks */
html[data-theme="notion"] .frosti-code {
  @apply bg-gray-50 border border-gray-200 rounded-lg shadow-sm;
  font-family: "JetBrains Mono", "Fira Code", "Consolas", "Monaco", "Courier New", monospace !important;
}

html[data-theme="notion"] .frosti-code .frosti-code-toolbar {
  @apply bg-gray-100 border-b border-gray-200 px-4 py-3;
}

html[data-theme="notion"] .frosti-code .frosti-code-toolbar-language {
  @apply text-xs font-medium text-gray-600 uppercase tracking-wide;
}

html[data-theme="notion"] .frosti-code .frosti-code-content pre {
  @apply bg-white p-4;
  font-family: inherit !important;
  font-size: 14px !important;
  line-height: 1.5 !important;
}

html[data-theme="notion"] .frosti-code .frosti-code-content .line::before {
  @apply text-gray-400 text-xs;
  font-family: inherit !important;
}

/* Allow natural horizontal scrolling when needed */
html,
body {
  overflow-x: auto;
}
