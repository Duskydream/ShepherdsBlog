<!DOCTYPE html><html class="bg-white dark:bg-gray-900" data-theme=autumn data-theme-type=light lang=zh><head><meta content=true name=astro-view-transitions-enabled><meta content=animate name=astro-view-transitions-fallback><script type=module src=/_astro/ClientRouter.astro_astro_type_script_index_0_lang.waUwC-PJ.js></script><script src=/_astro/vanilla.ChgcMPTJ.js data-astro-rerun></script><script type=module src=/_astro/PointerOnNavigation.astro_astro_type_script_index_0_lang.Dwfd1XXs.js></script><meta charset=utf-8><meta content="width=device-width,initial-scale=1" name=viewport><link href=https://pic1.imgdb.cn/item/68d4a75dc5157e1a882dbf13.svg rel=icon type=image><meta content="Astro v5.13.7" name=generator><meta content=给博客搭个追番页面 name=description><meta content=通过调用API实现博客追番页面 property=og:title><meta content=给博客搭个追番页面 property=og:description><meta content=https://duskydream.icu/og/bangumi.png property=og:image><link href=https://duskydream.icu/blog/bangumi/ rel=canonical><title>通过调用API实现博客追番页面 - Shepherd&#39;s Blog 櫻の森の上を舞う</title><script>!function(){const e="autumn",t="black";!function(){const m=localStorage.getItem("theme"),a=window.matchMedia("(prefers-color-scheme: dark)").matches;let c;m?c=m:(c=a?t:e,localStorage.setItem("theme",c)),document.documentElement.setAttribute("data-theme",c);const o=c===t?"dark":"light";document.documentElement.setAttribute("data-theme-type",o),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",(m=>{if(!localStorage.getItem("theme")){const a=m.matches?t:e;document.documentElement.setAttribute("data-theme",a),document.documentElement.setAttribute("data-theme-type",m.matches?"dark":"light"),localStorage.setItem("theme",a)}}))}()}()</script><link href=/_astro/anime.C-FZTPYt.css rel=stylesheet><style>.modal-backdrop[data-astro-cid-zux26muy] button[data-astro-cid-zux26muy]{cursor:default;width:100%;height:100%;opacity:0}.card-body .btn-category,.card-body .btn-tag{text-decoration:none}</style></head><body class="flex flex-col min-h-screen" data-pagefind-body=true><nav class="w-full bg-base-100 shadow-lg ease-in-out transform transition-transform delay-300 duration-500 fixed md:hidden navbar px-2 text-center z-50" id=navbar><div class=navbar-start><label class="btn btn-circle bg-base-100 btn-md swap swap-rotate"><span class=sr-only>Toggle menu</span> <input type=checkbox id=menu-toggle> <svg height=1em width=1em data-icon=lucide:menu class="h-5 w-5 swap-off"><symbol id=ai:lucide:menu viewBox="0 0 24 24"><path d="M4 5h16M4 12h16M4 19h16" fill=none stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 /></symbol><use href=#ai:lucide:menu></use></svg> <svg height=1em width=1em data-icon=lucide:x class="h-5 w-5 swap-on"><symbol id=ai:lucide:x viewBox="0 0 24 24"><path d="M18 6L6 18M6 6l12 12" fill=none stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 /></symbol><use href=#ai:lucide:x></use></svg></label></div><div class=navbar-center><a href=/ class="btn transition-transform btn-ghost hover:scale-105 duration-300 text-xl">Shepherd&#39;s Blog</a></div><div class=navbar-end><button class="btn btn-circle hover:scale-110 bg-base-100 btn-md md:border-base-content/20 shadow-sm navbar-theme" aria-label="Toggle theme" id=theme-toggle-e53j2jc8o data-astro-cid-mjqc4hpp data-theme-toggle title=主题切换><svg height=1em width=1em data-icon=lucide:sun class="h-5 w-5 theme-toggle-icon sun-icon" data-astro-cid-mjqc4hpp=true><symbol id=ai:lucide:sun viewBox="0 0 24 24"><g fill=none stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2><circle cx=12 cy=12 r=4 /><path d="M12 2v2m0 16v2M4.93 4.93l1.41 1.41m11.32 11.32l1.41 1.41M2 12h2m16 0h2M6.34 17.66l-1.41 1.41M19.07 4.93l-1.41 1.41"/></g></symbol><use href=#ai:lucide:sun></use></svg> <svg height=1em width=1em data-icon=lucide:moon class="h-5 w-5 theme-toggle-icon hidden moon-icon" data-astro-cid-mjqc4hpp=true><symbol id=ai:lucide:moon viewBox="0 0 24 24"><path d="M20.985 12.486a9 9 0 1 1-9.473-9.472c.405-.022.617.46.402.803a6 6 0 0 0 8.268 8.268c.344-.215.825-.004.803.401" fill=none stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 /></symbol><use href=#ai:lucide:moon></use></svg></button><script>!function(){const e="autumn",t="black",n=(e,t)=>{if(!e)return;const n=e.querySelector(".sun-icon"),o=e.querySelector(".moon-icon");n&&o&&(t?(n.classList.remove("hidden"),o.classList.add("hidden")):(n.classList.add("hidden"),o.classList.remove("hidden")))};document.addEventListener("astro:page-load",(()=>{const o=document.getElementById("theme-toggle-e53j2jc8o");if(!o)return;const c=document.documentElement.getAttribute("data-theme");n(o,c===t),o.addEventListener("click",(()=>{const c=document.documentElement.getAttribute("data-theme")===e?t:e;o.classList.add("animate-spin-once"),document.documentElement.setAttribute("data-theme",c);const d=c===t?"dark":"light";document.documentElement.setAttribute("data-theme-type",d),localStorage.setItem("theme",c);document.querySelectorAll("[data-theme-toggle]").forEach((e=>{n(e,c===t)})),setTimeout((()=>{o.classList.remove("animate-spin-once")}),300)}))}))}()</script></div><div class="w-full bg-base-100 shadow-lg ease-in-out transform transition-transform -translate-x-full absolute duration-300 left-0 top-full" id=header-menu><ul class="w-full bg-transparent menu p-2"><li class="relative w-full group"><a href=/about class="flex items-center rounded-lg hover:bg-base-200 font-bold p-3 text-lg" target=_self><svg height=1em width=1em data-icon=material-symbols:info-outline-rounded class="h-5 w-5 mr-2"><symbol id=ai:material-symbols:info-outline-rounded viewBox="0 0 24 24"><path d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11t-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8t-.288-.712T12 7t-.712.288T11 8t.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137T2.788 15.9T2 12t.788-3.9t2.137-3.175T8.1 2.788T12 2t3.9.788t3.175 2.137T21.213 8.1T22 12t-.788 3.9t-2.137 3.175t-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12t-2.325-5.675T12 4T6.325 6.325T4 12t2.325 5.675T12 20m0-8" fill=currentColor /></symbol><use href=#ai:material-symbols:info-outline-rounded></use></svg> <span>About</span></a></li><li class="relative w-full group"><a href=/blog class="flex items-center rounded-lg hover:bg-base-200 font-bold p-3 text-lg" target=_self><svg height=1em width=1em data-icon=material-symbols:book-2-outline-rounded class="h-5 w-5 mr-2"><symbol id=ai:material-symbols:book-2-outline-rounded viewBox="0 0 24 24"><path d="M6 15.325q.35-.175.725-.25T7.5 15H8V4h-.5q-.625 0-1.062.438T6 5.5zM10 15h8V4h-8zm-4 .325V4zM7.5 22q-1.45 0-2.475-1.025T4 18.5v-13q0-1.45 1.025-2.475T7.5 2H18q.825 0 1.413.587T20 4v12.525q0 .2-.162.363t-.588.362q-.35.175-.55.5t-.2.75t.2.763t.55.487t.55.413t.2.562v.25q0 .425-.288.725T19 22zm0-2h9.325q-.15-.35-.237-.712T16.5 18.5q0-.4.075-.775t.25-.725H7.5q-.65 0-1.075.438T6 18.5q0 .65.425 1.075T7.5 20" fill=currentColor /></symbol><use href=#ai:material-symbols:book-2-outline-rounded></use></svg> <span>Blogs</span></a></li><li class="relative w-full group"><a href=/log class="flex items-center rounded-lg hover:bg-base-200 font-bold p-3 text-lg" target=_self><svg height=1em width=1em data-icon=material-symbols:calendar-clock-outline-rounded class="h-5 w-5 mr-2"><symbol id=ai:material-symbols:calendar-clock-outline-rounded viewBox="0 0 24 24"><path d="M5 8h14V6H5zm0 0V6zm0 14q-.825 0-1.412-.587T3 20V6q0-.825.588-1.412T5 4h1V3q0-.425.288-.712T7 2t.713.288T8 3v1h8V3q0-.425.288-.712T17 2t.713.288T18 3v1h1q.825 0 1.413.588T21 6v4.675q0 .425-.288.713t-.712.287t-.712-.288t-.288-.712V10H5v10h5.8q.425 0 .713.288T11.8 21t-.288.713T10.8 22zm13 1q-2.075 0-3.537-1.463T13 18t1.463-3.537T18 13t3.538 1.463T23 18t-1.463 3.538T18 23m.5-5.2v-2.3q0-.2-.15-.35T18 15t-.35.15t-.15.35v2.275q0 .2.075.388t.225.337l1.525 1.525q.15.15.35.15t.35-.15t.15-.35t-.15-.35z" fill=currentColor /></symbol><use href=#ai:material-symbols:calendar-clock-outline-rounded></use></svg> <span>Log</span></a></li><li class="relative w-full group"><a href=/friend class="flex items-center rounded-lg hover:bg-base-200 font-bold p-3 text-lg" target=_self><svg height=1em width=1em data-icon=material-symbols:supervisor-account-outline-rounded class="h-5 w-5 mr-2"><symbol id=ai:material-symbols:supervisor-account-outline-rounded viewBox="0 0 24 24"><path d="M17 15q-1.05 0-1.775-.725T14.5 12.5t.725-1.775T17 10t1.775.725t.725 1.775t-.725 1.775T17 15m-5 4v-.4q0-.6.313-1.112t.887-.738q.9-.375 1.863-.562T17 16t1.938.188t1.862.562q.575.225.888.738T22 18.6v.4q0 .425-.288.713T21 20h-8q-.425 0-.712-.288T12 19m-2-7q-1.65 0-2.825-1.175T6 8t1.175-2.825T10 4t2.825 1.175T14 8t-1.175 2.825T10 12m-8 5.2q0-.85.425-1.562T3.6 14.55q1.5-.75 3.113-1.15T10 13q.875 0 1.75.15t1.75.35l-.85.85l-.85.85q-.45-.125-.9-.162T10 15q-1.45 0-2.838.35t-2.662 1q-.25.125-.375.35T4 17.2v.8h6v.975q0 .325.125.588t.35.437H4q-.825 0-1.412-.587T2 18zm8-7.2q.825 0 1.413-.587T12 8t-.587-1.412T10 6t-1.412.588T8 8t.588 1.413T10 10" fill=currentColor /></symbol><use href=#ai:material-symbols:supervisor-account-outline-rounded></use></svg> <span>Friends</span></a></li><li class="relative w-full group"><details><summary class="flex items-center rounded-lg hover:bg-base-200 font-bold p-3 text-lg"><svg height=1em width=1em data-icon=material-symbols:person-outline-rounded class="h-5 w-5 mr-2"><symbol id=ai:material-symbols:person-outline-rounded viewBox="0 0 24 24"><path d="M12 12q-1.65 0-2.825-1.175T8 8t1.175-2.825T12 4t2.825 1.175T16 8t-1.175 2.825T12 12m-8 6v-.8q0-.85.438-1.562T5.6 14.55q1.55-.775 3.15-1.162T12 13t3.25.388t3.15 1.162q.725.375 1.163 1.088T20 17.2v.8q0 .825-.587 1.413T18 20H6q-.825 0-1.412-.587T4 18m2 0h12v-.8q0-.275-.137-.5t-.363-.35q-1.35-.675-2.725-1.012T12 15t-2.775.338T6.5 16.35q-.225.125-.363.35T6 17.2zm6-8q.825 0 1.413-.587T14 8t-.587-1.412T12 6t-1.412.588T10 8t.588 1.413T12 10m0 8" fill=currentColor /></symbol><use href=#ai:material-symbols:person-outline-rounded></use></svg> <span>My</span></summary><ul class=pl-4><li><a href=/anime class="flex items-center rounded-lg hover:bg-base-200 p-2" target=_self><svg height=1em width=1em data-icon=material-symbols:live-tv-rounded class="h-4 w-4 mr-2"><symbol id=ai:material-symbols:live-tv-rounded viewBox="0 0 24 24"><path d="m11.05 14.5l4.15-2.65q.45-.3.45-.85t-.45-.85L11.05 7.5q-.5-.325-1.025-.05t-.525.875v5.35q0 .6.525.875t1.025-.05M4 19q-.825 0-1.412-.587T2 17V5q0-.825.588-1.412T4 3h16q.825 0 1.413.588T22 5v12q0 .825-.587 1.413T20 19h-4v1q0 .425-.288.713T15 21H9q-.425 0-.712-.288T8 20v-1z" fill=currentColor /></symbol><use href=#ai:material-symbols:live-tv-rounded></use></svg> <span>Anime</span></a></li></ul></details></li><li class="relative w-full group"><details><summary class="flex items-center rounded-lg hover:bg-base-200 font-bold p-3 text-lg"><svg height=1em width=1em data-icon=material-symbols:add-link class="h-5 w-5 mr-2"><symbol id=ai:material-symbols:add-link viewBox="0 0 24 24"><path d="M17 20v-3h-3v-2h3v-3h2v3h3v2h-3v3zm-6-3H7q-2.075 0-3.537-1.463T2 12t1.463-3.537T7 7h4v2H7q-1.25 0-2.125.875T4 12t.875 2.125T7 15h4zm-3-4v-2h8v2zm14-1h-2q0-1.25-.875-2.125T17 9h-4V7h4q2.075 0 3.538 1.463T22 12" fill=currentColor /></symbol><use href=#ai:material-symbols:add-link></use></svg> <span>Links</span></summary><ul class=pl-4><li><a href=https://chatgpt.com/ class="flex items-center rounded-lg hover:bg-base-200 p-2" target=_blank><svg height=1em width=1em data-icon=ri:openai-fill class="h-4 w-4 mr-2"><symbol id=ai:ri:openai-fill viewBox="0 0 24 24"><path d="M20.562 10.188c.25-.688.313-1.376.25-2.063c-.062-.687-.312-1.375-.625-2c-.562-.937-1.375-1.687-2.312-2.125c-1-.437-2.063-.562-3.125-.312c-.5-.5-1.063-.938-1.688-1.25S11.687 2 11 2a5.17 5.17 0 0 0-3 .938c-.875.624-1.5 1.5-1.813 2.5c-.75.187-1.375.5-2 .875c-.562.437-1 1-1.375 1.562c-.562.938-.75 2-.625 3.063a5.44 5.44 0 0 0 1.25 2.874a4.7 4.7 0 0 0-.25 2.063c.063.688.313 1.375.625 2c.563.938 1.375 1.688 2.313 2.125c1 .438 2.062.563 3.125.313c.5.5 1.062.937 1.687 1.25S12.312 22 13 22a5.17 5.17 0 0 0 3-.937c.875-.625 1.5-1.5 1.812-2.5a4.54 4.54 0 0 0 1.938-.875c.562-.438 1.062-.938 1.375-1.563c.562-.937.75-2 .625-3.062c-.125-1.063-.5-2.063-1.188-2.876m-7.5 10.5c-1 0-1.75-.313-2.437-.875c0 0 .062-.063.125-.063l4-2.312a.5.5 0 0 0 .25-.25a.57.57 0 0 0 .062-.313V11.25l1.688 1v4.625a3.685 3.685 0 0 1-3.688 3.813M5 17.25c-.438-.75-.625-1.625-.438-2.5c0 0 .063.063.125.063l4 2.312a.56.56 0 0 0 .313.063c.125 0 .25 0 .312-.063l4.875-2.812v1.937l-4.062 2.375A3.7 3.7 0 0 1 7.312 19c-1-.25-1.812-.875-2.312-1.75M3.937 8.563a3.8 3.8 0 0 1 1.938-1.626v4.751c0 .124 0 .25.062.312a.5.5 0 0 0 .25.25l4.875 2.813l-1.687 1l-4-2.313a3.7 3.7 0 0 1-1.75-2.25c-.25-.937-.188-2.062.312-2.937M17.75 11.75l-4.875-2.812l1.687-1l4 2.312c.625.375 1.125.875 1.438 1.5s.5 1.313.437 2.063a3.7 3.7 0 0 1-.75 1.937c-.437.563-1 1-1.687 1.25v-4.75c0-.125 0-.25-.063-.312c0 0-.062-.126-.187-.188m1.687-2.5s-.062-.062-.125-.062l-4-2.313c-.125-.062-.187-.062-.312-.062s-.25 0-.313.062L9.812 9.688V7.75l4.063-2.375c.625-.375 1.312-.5 2.062-.5c.688 0 1.375.25 2 .688c.563.437 1.063 1 1.313 1.625s.312 1.375.187 2.062m-10.5 3.5l-1.687-1V7.063c0-.688.187-1.438.562-2C8.187 4.438 8.75 4 9.375 3.688a3.37 3.37 0 0 1 2.062-.313c.688.063 1.375.375 1.938.813c0 0-.063.062-.125.062l-4 2.313a.5.5 0 0 0-.25.25c-.063.125-.063.187-.063.312zm.875-2L12 9.5l2.187 1.25v2.5L12 14.5l-2.188-1.25z" fill=currentColor /></symbol><use href=#ai:ri:openai-fill></use></svg> <span>ChatGPT</span></a></li><li><a href=https://gemini.google.com/ class="flex items-center rounded-lg hover:bg-base-200 p-2" target=_blank><svg height=1em width=1em data-icon=ri:gemini-fill class="h-4 w-4 mr-2"><symbol id=ai:ri:gemini-fill viewBox="0 0 24 24"><path d="M24 12.024c-6.437.388-11.59 5.539-11.977 11.976h-.047C11.588 17.563 6.436 12.412 0 12.024v-.047C6.437 11.588 11.588 6.437 11.976 0h.047c.388 6.437 5.54 11.588 11.977 11.977z" fill=currentColor /></symbol><use href=#ai:ri:gemini-fill></use></svg> <span>Google Gemini</span></a></li></ul></details></li></ul></div></nav><script type=module>document.addEventListener("astro:page-load",(()=>{let e=window.scrollY;const t=document.getElementById("navbar"),s=document.getElementById("header-menu"),a=document.getElementById("menu-toggle");if(!t||!s||!a)return;a.addEventListener("change",(()=>{a.checked?(s.classList.remove("-translate-x-full"),s.classList.add("translate-x-0")):(s.classList.add("-translate-x-full"),s.classList.remove("translate-x-0"))}));let l=!1;window.addEventListener("scroll",(()=>{l||(window.requestAnimationFrame((()=>{!t||!s||!a||(window.scrollY>e&&window.scrollY>50?(t.classList.add("-translate-y-full","duration-500"),t.classList.remove("translate-y-0"),a.checked&&(a.checked=!1,s.classList.add("-translate-x-full"),s.classList.remove("translate-x-0"))):window.scrollY<e&&(t.classList.remove("-translate-y-full"),t.classList.add("translate-y-0","duration-300")),e=window.scrollY),l=!1})),l=!0)})),document.addEventListener("click",(e=>{if(!t||!s||!a)return;const l=e.target;!t.contains(l)&&s.classList.contains("translate-x-0")&&(a.checked=!1,s.classList.add("-translate-x-full"),s.classList.remove("translate-x-0"))})),document.querySelectorAll("#header-menu a").forEach((e=>{e.addEventListener("click",(()=>{!s||!a||a.checked&&(a.checked=!1,s.classList.add("-translate-x-full"),s.classList.remove("translate-x-0"))}))}))}))</script><div class=relative><section class="flex items-center justify-center text-center banner h-screen overflow-hidden relative w-full" data-astro-cid-kggsjsm4><div class="absolute inset-0" data-astro-cid-kggsjsm4><img alt=博客头图 class="w-full fixed banner-img h-full left-0 object-cover top-0" src=https://pic1.imgdb.cn/item/68ddfebec5157e1a884e700b.jpg data-astro-cid-kggsjsm4></div><div class="relative px-4 z-20 text-white" data-astro-cid-kggsjsm4><h1 class="text-white drop-shadow-2xl font-bold md:text-5xl text-3xl" data-astro-cid-kggsjsm4 data-title="Shepherd's Blog" id=banner-title>Shepherd&#39;s Blog</h1><p class="text-white drop-shadow-xl md:text-2xl mt-2 text-lg" data-astro-cid-kggsjsm4 data-subtitle="C'est mon Panache!" id=banner-subtitle>C&#39;est mon Panache!</p></div><canvas class="absolute pointer-events-none inset-0 z-10" data-astro-cid-te2swpsm id=shooting-stars></canvas><script>const canvas=document.getElementById("shooting-stars"),ctx=canvas.getContext("2d");function resize(){canvas.width=window.innerWidth,canvas.height=window.innerHeight}resize(),window.addEventListener("resize",resize);class ShootingStar{constructor(){this.reset()}reset(){this.x=Math.random()*canvas.width,this.y=Math.random()*canvas.height*.5,this.len=80*Math.random()+50,this.speed=10*Math.random()+6,this.size=2*Math.random()+1,this.angle=Math.PI/4,this.opacity=1}update(){this.x+=Math.cos(this.angle)*this.speed,this.y+=Math.sin(this.angle)*this.speed,this.opacity-=.02,this.opacity<=0&&this.reset()}draw(){ctx.beginPath();const t=ctx.createLinearGradient(this.x,this.y,this.x-this.len,this.y-this.len);t.addColorStop(0,`rgba(255,255,255,${this.opacity})`),t.addColorStop(1,"transparent"),ctx.strokeStyle=t,ctx.lineWidth=this.size,ctx.moveTo(this.x,this.y),ctx.lineTo(this.x-this.len,this.y-this.len),ctx.stroke()}}const stars=Array.from({length:6},(()=>new ShootingStar));function animate(){ctx.clearRect(0,0,canvas.width,canvas.height),stars.forEach((t=>{t.update(),t.draw()})),requestAnimationFrame(animate)}animate()</script></section><script type=module>document.addEventListener("astro:page-load",(()=>{const t=document.getElementById("banner-title"),e=document.getElementById("banner-subtitle");if(!t)return;const n=t.dataset.title||"",s=e&&e.dataset.subtitle||"";function i(t,e,n=100,s){let i=0;t.classList.add("cursor-blinking"),t.textContent="",function o(){i<e.length?(t.textContent=e.substring(0,i+1),i++,setTimeout(o,n)):(t.classList.remove("cursor-blinking"),s&&s())}()}setTimeout((()=>{i(t,n,100,(()=>{e&&s&&i(e,s,80)}))}),300)}))</script><div class="relative w-full -mt-32 max-w-7xl mx-auto px-4 z-20"><div class="backdrop-blur-md bg-white/70 dark:bg-white/30 md:p-12 p-6 rounded-lg shadow-lg"><div class="gap-4 grid grid-cols-1 lg:grid-cols-5 md:grid-cols-6"><main class="flex flex-col col-span-1 gap-4 lg:col-span-4 md:col-span-5">><div class="w-full bg-base-100 shadow-lg rounded-xl overflow-hidden"><div class="pt-6 px-6"><h1 class="lg:text-4xl font-bold sm:text-2xl text-xl">通过调用API实现博客追番页面</h1><p class="text-sm mt-2 text-base-content/80">给博客搭个追番页面</p></div><div class="sm:p-6 p-4"><div class="flex flex-col gap-y-2 mb-4 opacity-75 sm:flex-row sm:justify-between sm:text-sm text-xs"><div class="flex items-center flex-wrap gap-x-4 gap-y-2"><span class="flex items-center gap-1"><svg height=1em width=1em data-icon=lucide:calendar class="h-4 w-4 flex-shrink-0"><symbol id=ai:lucide:calendar viewBox="0 0 24 24"><g fill=none stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2><path d="M8 2v4m8-4v4"/><rect height=18 rx=2 width=18 x=3 y=4 /><path d="M3 10h18"/></g></symbol><use href=#ai:lucide:calendar></use></svg> <span class=truncate>周五 10月 03 2025</span></span></div><div class="flex items-center gap-1 flex-wrap"><svg height=1em width=1em data-icon=lucide:book-open class="h-4 w-4 flex-shrink-0"><symbol id=ai:lucide:book-open viewBox="0 0 24 24"><path d="M12 7v14m-9-3a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4a4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3a3 3 0 0 0-3-3z" fill=none stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 /></symbol><use href=#ai:lucide:book-open></use></svg> <span class=truncate>1422 字 · 14 分钟</span></div></div><div class=mb-6><div class="flex items-center flex-wrap gap-2"><a href=/blog/category/FrontendDeveloping class="btn btn-xs btn-category"><svg height=1em width=1em data-icon=lucide:folder class="h-4 w-4"><symbol id=ai:lucide:folder viewBox="0 0 24 24"><path d="M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z" fill=none stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 /></symbol><use href=#ai:lucide:folder></use></svg> <span>FrontendDeveloping</span> </a><a href=/blog/tag/Anime class="btn btn-xs btn-tag"><svg height=1em width=1em data-icon=lucide:tag class="h-4 w-4"><symbol id=ai:lucide:tag viewBox="0 0 24 24"><g fill=none stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2><path d="M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z"/><circle cx=7.5 cy=7.5 r=.5 fill=currentColor /></g></symbol><use href=#ai:lucide:tag></use></svg> <span>Anime</span></a></div></div><div class=mt-8><div class="max-w-none prose prose-headings:scroll-mt-20 prose-img:mx-auto prose-img:rounded-xl" id=content><h1 id=通过调用bangumi-api实现博客追番页面>通过调用Bangumi API实现博客追番页面</h1><h2 id=功能>功能：</h2><p>1.实时更新Bangumi的“已看/想看/在看”的番剧/游戏/小说（未作区分）；</p><p>2.搜索功能；</p><p>3.实时调用以及页面刷新</p><h2 id=方法>方法</h2><h3 id=1注册bangumi账号>1.注册Bangumi账号</h3><p>访问www.bgm.tv(自测www.bangumi.tv需要代理)，注册账号，可浏览ACG作品并选择已看/想看/在看。点右上角图标进入个人页面记下左上角用户名旁的@id（不是用户名）。</p><h3 id=2页面搭建以astro为例>2.页面搭建（以Astro为例）</h3><p>在Blog的pages页面创建/api文件夹，新建bangumi.ts</p><div class=expressive-code><link href=/_astro/ec.oj3b7.css rel=stylesheet><script type=module src=/_astro/ec.p1z7b.js></script><figure class=frame><figcaption class=header></figcaption><pre data-language=ts><code><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>1</div></div><div class=code><span style=--0:#F97583>import</span><span style=--0:#E1E4E8> </span><span style=--0:#F97583>type</span><span style=--0:#E1E4E8> { APIRoute } </span><span style=--0:#F97583>from</span><span style=--0:#E1E4E8> </span><span style=--0:#9ECBFF>"astro"</span><span style=--0:#E1E4E8>;</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>2</div></div><div class=code><span style=--0:#F97583>import</span><span style=--0:#E1E4E8> fs </span><span style=--0:#F97583>from</span><span style=--0:#E1E4E8> </span><span style=--0:#9ECBFF>"node:fs/promises"</span><span style=--0:#E1E4E8>;</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>3</div></div><div class=code><span style=--0:#F97583>import</span><span style=--0:#E1E4E8> path </span><span style=--0:#F97583>from</span><span style=--0:#E1E4E8> </span><span style=--0:#9ECBFF>"node:path"</span><span style=--0:#E1E4E8>;</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>4</div></div><div class=code><span style=--0:#F97583>import</span><span style=--0:#E1E4E8> process </span><span style=--0:#F97583>from</span><span style=--0:#E1E4E8> </span><span style=--0:#9ECBFF>"node:process"</span><span style=--0:#E1E4E8>;</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>5</div></div><div class=code>
</div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>6</div></div><div class=code><span style=--0:#F97583>const</span><span style=--0:#E1E4E8> </span><span style=--0:#79B8FF>username</span><span style=--0:#E1E4E8> </span><span style=--0:#F97583>=</span><span style=--0:#E1E4E8> </span><span style=--0:#9ECBFF>""</span><span style=--0:#E1E4E8>;</span><span style=--0:#99A0A6>// 在这里填上@id的内容</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>7</div></div><div class=code><span style=--0:#F97583>const</span><span style=--0:#E1E4E8> </span><span style=--0:#79B8FF>baseUrl</span><span style=--0:#E1E4E8> </span><span style=--0:#F97583>=</span><span style=--0:#E1E4E8> </span><span style=--0:#9ECBFF>`https://api.bgm.tv/v0/users/${</span><span style=--0:#E1E4E8>username</span><span style=--0:#9ECBFF>}/collections`</span><span style=--0:#E1E4E8>;</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>8</div></div><div class=code><span style=--0:#F97583>const</span><span style=--0:#E1E4E8> </span><span style=--0:#79B8FF>CACHE_TTL_MS</span><span style=--0:#E1E4E8> </span><span style=--0:#F97583>=</span><span style=--0:#E1E4E8> </span><span style=--0:#79B8FF>60</span><span style=--0:#E1E4E8> </span><span style=--0:#F97583>*</span><span style=--0:#E1E4E8> </span><span style=--0:#79B8FF>60</span><span style=--0:#E1E4E8> </span><span style=--0:#F97583>*</span><span style=--0:#E1E4E8> </span><span style=--0:#79B8FF>1000</span><span style=--0:#E1E4E8>; </span><span style=--0:#99A0A6>// 这里是调用api的时间间隔，默认为60分钟</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>9</div></div><div class=code><span style=--0:#99A0A6>// Use /tmp on Vercel/serverless (writable), otherwise local .cache directory</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>10</div></div><div class=code><span style=--0:#F97583>const</span><span style=--0:#E1E4E8> </span><span style=--0:#79B8FF>CACHE_DIR</span><span style=--0:#E1E4E8> </span><span style=--0:#F97583>=</span><span style=--0:#E1E4E8> process.env.</span><span style=--0:#79B8FF>VERCEL</span><span style=--0:#E1E4E8> </span><span style=--0:#F97583>?</span><span style=--0:#E1E4E8> </span><span style=--0:#9ECBFF>"/tmp"</span><span style=--0:#E1E4E8> </span><span style=--0:#F97583>:</span><span style=--0:#E1E4E8> path.</span><span style=--0:#B392F0>resolve</span><span style=--0:#E1E4E8>(process.</span><span style=--0:#B392F0>cwd</span><span style=--0:#E1E4E8>(), </span><span style=--0:#9ECBFF>".cache"</span><span style=--0:#E1E4E8>);</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>11</div></div><div class=code><span style=--0:#F97583>const</span><span style=--0:#E1E4E8> </span><span style=--0:#79B8FF>CACHE_FILE</span><span style=--0:#E1E4E8> </span><span style=--0:#F97583>=</span><span style=--0:#E1E4E8> path.</span><span style=--0:#B392F0>join</span><span style=--0:#E1E4E8>(</span><span style=--0:#79B8FF>CACHE_DIR</span><span style=--0:#E1E4E8>, </span><span style=--0:#9ECBFF>"bangumi.json"</span><span style=--0:#E1E4E8>);</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>12</div></div><div class=code>
</div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>13</div></div><div class=code><span style=--0:#F97583>async</span><span style=--0:#E1E4E8> </span><span style=--0:#F97583>function</span><span style=--0:#E1E4E8> </span><span style=--0:#B392F0>fetchCollectionType</span><span style=--0:#E1E4E8>(</span><span style=--0:#FFAB70>type</span><span style=--0:#F97583>:</span><span style=--0:#E1E4E8> </span><span style=--0:#79B8FF>number</span><span style=--0:#E1E4E8>) {</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>14</div></div><div class=code><span class=indent>  </span><span style=--0:#F97583>let</span><span style=--0:#E1E4E8> page </span><span style=--0:#F97583>=</span><span style=--0:#E1E4E8> </span><span style=--0:#79B8FF>1</span><span style=--0:#E1E4E8>;</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>15</div></div><div class=code><span class=indent>  </span><span style=--0:#F97583>const</span><span style=--0:#E1E4E8> </span><span style=--0:#79B8FF>limit</span><span style=--0:#E1E4E8> </span><span style=--0:#F97583>=</span><span style=--0:#E1E4E8> </span><span style=--0:#79B8FF>30</span><span style=--0:#E1E4E8>;</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>16</div></div><div class=code><span class=indent>  </span><span style=--0:#F97583>let</span><span style=--0:#E1E4E8> all</span><span style=--0:#F97583>:</span><span style=--0:#E1E4E8> </span><span style=--0:#79B8FF>any</span><span style=--0:#E1E4E8>[] </span><span style=--0:#F97583>=</span><span style=--0:#E1E4E8> [];</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>17</div></div><div class=code><span class=indent>  </span><span style=--0:#F97583>try</span><span style=--0:#E1E4E8> {</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>18</div></div><div class=code><span class=indent>    </span><span style=--0:#F97583>while</span><span style=--0:#E1E4E8> (</span><span style=--0:#79B8FF>true</span><span style=--0:#E1E4E8>) {</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>19</div></div><div class=code><span class=indent>      </span><span style=--0:#F97583>const</span><span style=--0:#E1E4E8> </span><span style=--0:#79B8FF>res</span><span style=--0:#E1E4E8> </span><span style=--0:#F97583>=</span><span style=--0:#E1E4E8> </span><span style=--0:#F97583>await</span><span style=--0:#E1E4E8> </span><span style=--0:#B392F0>fetch</span><span style=--0:#E1E4E8>(</span><span style=--0:#9ECBFF>`${</span><span style=--0:#E1E4E8>baseUrl</span><span style=--0:#9ECBFF>}?type=${</span><span style=--0:#E1E4E8>type</span><span style=--0:#9ECBFF>}&#x26;limit=${</span><span style=--0:#E1E4E8>limit</span><span style=--0:#9ECBFF>}&#x26;offset=${</span><span style=--0:#9ECBFF>(</span><span style=--0:#E1E4E8>page</span><span style=--0:#9ECBFF> </span><span style=--0:#F97583>-</span><span style=--0:#9ECBFF> </span><span style=--0:#79B8FF>1</span><span style=--0:#9ECBFF>) </span><span style=--0:#F97583>*</span><span style=--0:#9ECBFF> </span><span style=--0:#E1E4E8>limit</span><span style=--0:#9ECBFF>}`</span><span style=--0:#E1E4E8>, {</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>20</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>        </span></span><span style=--0:#E1E4E8>headers: { </span><span style=--0:#9ECBFF>"User-Agent"</span><span style=--0:#E1E4E8>: </span><span style=--0:#9ECBFF>"AstroBlog/1.0 (https://yourblog.com)"</span><span style=--0:#E1E4E8> },</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>21</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>      </span></span><span style=--0:#E1E4E8>});</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>22</div></div><div class=code><span class=indent>      </span><span style=--0:#F97583>if</span><span style=--0:#E1E4E8> (</span><span style=--0:#F97583>!</span><span style=--0:#E1E4E8>res.ok)</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>23</div></div><div class=code><span class=indent>        </span><span style=--0:#F97583>break</span><span style=--0:#E1E4E8>;</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>24</div></div><div class=code><span class=indent>      </span><span style=--0:#F97583>const</span><span style=--0:#E1E4E8> </span><span style=--0:#79B8FF>j</span><span style=--0:#E1E4E8> </span><span style=--0:#F97583>=</span><span style=--0:#E1E4E8> </span><span style=--0:#F97583>await</span><span style=--0:#E1E4E8> res.</span><span style=--0:#B392F0>json</span><span style=--0:#E1E4E8>();</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>25</div></div><div class=code><span class=indent>      </span><span style=--0:#F97583>if</span><span style=--0:#E1E4E8> (</span><span style=--0:#F97583>!</span><span style=--0:#E1E4E8>j.data </span><span style=--0:#F97583>||</span><span style=--0:#E1E4E8> j.data.</span><span style=--0:#79B8FF>length</span><span style=--0:#E1E4E8> </span><span style=--0:#F97583>===</span><span style=--0:#E1E4E8> </span><span style=--0:#79B8FF>0</span><span style=--0:#E1E4E8>)</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>26</div></div><div class=code><span class=indent>        </span><span style=--0:#F97583>break</span><span style=--0:#E1E4E8>;</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>27</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>      </span></span><span style=--0:#E1E4E8>all </span><span style=--0:#F97583>=</span><span style=--0:#E1E4E8> all.</span><span style=--0:#B392F0>concat</span><span style=--0:#E1E4E8>(j.data);</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>28</div></div><div class=code><span class=indent>      </span><span style=--0:#F97583>if</span><span style=--0:#E1E4E8> (j.data.</span><span style=--0:#79B8FF>length</span><span style=--0:#E1E4E8> </span><span style=--0:#F97583>&#x3C;</span><span style=--0:#E1E4E8> limit)</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>29</div></div><div class=code><span class=indent>        </span><span style=--0:#F97583>break</span><span style=--0:#E1E4E8>;</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>30</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>      </span></span><span style=--0:#E1E4E8>page</span><span style=--0:#F97583>++</span><span style=--0:#E1E4E8>;</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>31</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>    </span></span><span style=--0:#E1E4E8>}</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>32</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>  </span></span><span style=--0:#E1E4E8>}</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>33</div></div><div class=code><span class=indent>  </span><span style=--0:#F97583>catch</span><span style=--0:#E1E4E8> (e) {</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>34</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>    </span></span><span style=--0:#E1E4E8>console.</span><span style=--0:#B392F0>error</span><span style=--0:#E1E4E8>(</span><span style=--0:#9ECBFF>"fetchCollectionType error:"</span><span style=--0:#E1E4E8>, e);</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>35</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>  </span></span><span style=--0:#E1E4E8>}</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>36</div></div><div class=code><span class=indent>  </span><span style=--0:#F97583>return</span><span style=--0:#E1E4E8> all;</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>37</div></div><div class=code><span style=--0:#E1E4E8>}</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>38</div></div><div class=code>
</div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>39</div></div><div class=code><span style=--0:#F97583>async</span><span style=--0:#E1E4E8> </span><span style=--0:#F97583>function</span><span style=--0:#E1E4E8> </span><span style=--0:#B392F0>readCache</span><span style=--0:#E1E4E8>() {</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>40</div></div><div class=code><span class=indent>  </span><span style=--0:#F97583>try</span><span style=--0:#E1E4E8> {</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>41</div></div><div class=code><span class=indent>    </span><span style=--0:#F97583>const</span><span style=--0:#E1E4E8> </span><span style=--0:#79B8FF>raw</span><span style=--0:#E1E4E8> </span><span style=--0:#F97583>=</span><span style=--0:#E1E4E8> </span><span style=--0:#F97583>await</span><span style=--0:#E1E4E8> fs.</span><span style=--0:#B392F0>readFile</span><span style=--0:#E1E4E8>(</span><span style=--0:#79B8FF>CACHE_FILE</span><span style=--0:#E1E4E8>, </span><span style=--0:#9ECBFF>"utf-8"</span><span style=--0:#E1E4E8>);</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>42</div></div><div class=code><span class=indent>    </span><span style=--0:#F97583>return</span><span style=--0:#E1E4E8> </span><span style=--0:#79B8FF>JSON</span><span style=--0:#E1E4E8>.</span><span style=--0:#B392F0>parse</span><span style=--0:#E1E4E8>(raw);</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>43</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>  </span></span><span style=--0:#E1E4E8>}</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>44</div></div><div class=code><span class=indent>  </span><span style=--0:#F97583>catch</span><span style=--0:#E1E4E8> {</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>45</div></div><div class=code><span class=indent>    </span><span style=--0:#F97583>return</span><span style=--0:#E1E4E8> </span><span style=--0:#79B8FF>null</span><span style=--0:#E1E4E8>;</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>46</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>  </span></span><span style=--0:#E1E4E8>}</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>47</div></div><div class=code><span style=--0:#E1E4E8>}</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>48</div></div><div class=code><span style=--0:#F97583>async</span><span style=--0:#E1E4E8> </span><span style=--0:#F97583>function</span><span style=--0:#E1E4E8> </span><span style=--0:#B392F0>writeCache</span><span style=--0:#E1E4E8>(</span><span style=--0:#FFAB70>obj</span><span style=--0:#F97583>:</span><span style=--0:#E1E4E8> </span><span style=--0:#79B8FF>any</span><span style=--0:#E1E4E8>) {</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>49</div></div><div class=code><span class=indent>  </span><span style=--0:#F97583>try</span><span style=--0:#E1E4E8> {</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>50</div></div><div class=code><span class=indent>    </span><span style=--0:#F97583>await</span><span style=--0:#E1E4E8> fs.</span><span style=--0:#B392F0>mkdir</span><span style=--0:#E1E4E8>(path.</span><span style=--0:#B392F0>dirname</span><span style=--0:#E1E4E8>(</span><span style=--0:#79B8FF>CACHE_FILE</span><span style=--0:#E1E4E8>), { recursive: </span><span style=--0:#79B8FF>true</span><span style=--0:#E1E4E8> });</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>51</div></div><div class=code><span class=indent>    </span><span style=--0:#F97583>await</span><span style=--0:#E1E4E8> fs.</span><span style=--0:#B392F0>writeFile</span><span style=--0:#E1E4E8>(</span><span style=--0:#79B8FF>CACHE_FILE</span><span style=--0:#E1E4E8>, </span><span style=--0:#79B8FF>JSON</span><span style=--0:#E1E4E8>.</span><span style=--0:#B392F0>stringify</span><span style=--0:#E1E4E8>(obj), </span><span style=--0:#9ECBFF>"utf-8"</span><span style=--0:#E1E4E8>);</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>52</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>  </span></span><span style=--0:#E1E4E8>}</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>53</div></div><div class=code><span class=indent>  </span><span style=--0:#F97583>catch</span><span style=--0:#E1E4E8> (e) {</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>54</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>    </span></span><span style=--0:#E1E4E8>console.</span><span style=--0:#B392F0>warn</span><span style=--0:#E1E4E8>(</span><span style=--0:#9ECBFF>"writeCache failed:"</span><span style=--0:#E1E4E8>, e);</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>55</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>  </span></span><span style=--0:#E1E4E8>}</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>56</div></div><div class=code><span style=--0:#E1E4E8>}</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>57</div></div><div class=code>
</div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>58</div></div><div class=code><span style=--0:#F97583>export</span><span style=--0:#E1E4E8> </span><span style=--0:#F97583>const</span><span style=--0:#E1E4E8> </span><span style=--0:#B392F0>GET</span><span style=--0:#F97583>:</span><span style=--0:#E1E4E8> </span><span style=--0:#B392F0>APIRoute</span><span style=--0:#E1E4E8> </span><span style=--0:#F97583>=</span><span style=--0:#E1E4E8> </span><span style=--0:#F97583>async</span><span style=--0:#E1E4E8> ({ </span><span style=--0:#FFAB70>url</span><span style=--0:#E1E4E8> }) </span><span style=--0:#F97583>=></span><span style=--0:#E1E4E8> {</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>59</div></div><div class=code><span class=indent>  </span><span style=--0:#F97583>const</span><span style=--0:#E1E4E8> </span><span style=--0:#79B8FF>force</span><span style=--0:#E1E4E8> </span><span style=--0:#F97583>=</span><span style=--0:#E1E4E8> url.searchParams.</span><span style=--0:#B392F0>get</span><span style=--0:#E1E4E8>(</span><span style=--0:#9ECBFF>"force"</span><span style=--0:#E1E4E8>) </span><span style=--0:#F97583>===</span><span style=--0:#E1E4E8> </span><span style=--0:#9ECBFF>"1"</span><span style=--0:#E1E4E8> </span><span style=--0:#F97583>||</span><span style=--0:#E1E4E8> url.searchParams.</span><span style=--0:#B392F0>get</span><span style=--0:#E1E4E8>(</span><span style=--0:#9ECBFF>"refresh"</span><span style=--0:#E1E4E8>) </span><span style=--0:#F97583>===</span><span style=--0:#E1E4E8> </span><span style=--0:#9ECBFF>"1"</span><span style=--0:#E1E4E8>;</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>60</div></div><div class=code>
</div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>61</div></div><div class=code><span class=indent>  </span><span style=--0:#99A0A6>// Try read file cache unless force refresh requested</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>62</div></div><div class=code><span class=indent>  </span><span style=--0:#F97583>const</span><span style=--0:#E1E4E8> </span><span style=--0:#79B8FF>now</span><span style=--0:#E1E4E8> </span><span style=--0:#F97583>=</span><span style=--0:#E1E4E8> Date.</span><span style=--0:#B392F0>now</span><span style=--0:#E1E4E8>();</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>63</div></div><div class=code><span class=indent>  </span><span style=--0:#F97583>if</span><span style=--0:#E1E4E8> (</span><span style=--0:#F97583>!</span><span style=--0:#E1E4E8>force) {</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>64</div></div><div class=code><span class=indent>    </span><span style=--0:#F97583>const</span><span style=--0:#E1E4E8> </span><span style=--0:#79B8FF>fileCache</span><span style=--0:#E1E4E8> </span><span style=--0:#F97583>=</span><span style=--0:#E1E4E8> </span><span style=--0:#F97583>await</span><span style=--0:#E1E4E8> </span><span style=--0:#B392F0>readCache</span><span style=--0:#E1E4E8>();</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>65</div></div><div class=code><span class=indent>    </span><span style=--0:#F97583>if</span><span style=--0:#E1E4E8> (fileCache </span><span style=--0:#F97583>&#x26;&#x26;</span><span style=--0:#E1E4E8> fileCache.cachedAt </span><span style=--0:#F97583>&#x26;&#x26;</span><span style=--0:#E1E4E8> (now </span><span style=--0:#F97583>-</span><span style=--0:#E1E4E8> fileCache.cachedAt) </span><span style=--0:#F97583>&#x3C;</span><span style=--0:#E1E4E8> </span><span style=--0:#79B8FF>CACHE_TTL_MS</span><span style=--0:#E1E4E8>) {</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>66</div></div><div class=code><span class=indent>      </span><span style=--0:#F97583>return</span><span style=--0:#E1E4E8> </span><span style=--0:#F97583>new</span><span style=--0:#E1E4E8> </span><span style=--0:#B392F0>Response</span><span style=--0:#E1E4E8>(</span><span style=--0:#79B8FF>JSON</span><span style=--0:#E1E4E8>.</span><span style=--0:#B392F0>stringify</span><span style=--0:#E1E4E8>({ </span><span style=--0:#F97583>...</span><span style=--0:#E1E4E8>fileCache, servedFrom: </span><span style=--0:#9ECBFF>"file-cache"</span><span style=--0:#E1E4E8> }), {</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>67</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>        </span></span><span style=--0:#E1E4E8>status: </span><span style=--0:#79B8FF>200</span><span style=--0:#E1E4E8>,</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>68</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>        </span></span><span style=--0:#E1E4E8>headers: {</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>69</div></div><div class=code><span class=indent>          </span><span style=--0:#9ECBFF>"Content-Type"</span><span style=--0:#E1E4E8>: </span><span style=--0:#9ECBFF>"application/json"</span><span style=--0:#E1E4E8>,</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>70</div></div><div class=code><span class=indent>          </span><span style=--0:#99A0A6>// prevent CDN/browser caching of this response to ensure client-side refresh always revalidates</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>71</div></div><div class=code><span class=indent>          </span><span style=--0:#9ECBFF>"Cache-Control"</span><span style=--0:#E1E4E8>: </span><span style=--0:#9ECBFF>"no-store, max-age=0"</span><span style=--0:#E1E4E8>,</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>72</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>        </span></span><span style=--0:#E1E4E8>},</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>73</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>      </span></span><span style=--0:#E1E4E8>});</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>74</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>    </span></span><span style=--0:#E1E4E8>}</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>75</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>  </span></span><span style=--0:#E1E4E8>}</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>76</div></div><div class=code>
</div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>77</div></div><div class=code><span class=indent>  </span><span style=--0:#99A0A6>// Otherwise fetch fresh (or partial) and save</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>78</div></div><div class=code><span class=indent>  </span><span style=--0:#F97583>const</span><span style=--0:#E1E4E8> [</span><span style=--0:#79B8FF>watching</span><span style=--0:#E1E4E8>, </span><span style=--0:#79B8FF>wish</span><span style=--0:#E1E4E8>, </span><span style=--0:#79B8FF>watched</span><span style=--0:#E1E4E8>] </span><span style=--0:#F97583>=</span><span style=--0:#E1E4E8> </span><span style=--0:#F97583>await</span><span style=--0:#E1E4E8> </span><span style=--0:#79B8FF>Promise</span><span style=--0:#E1E4E8>.</span><span style=--0:#B392F0>all</span><span style=--0:#E1E4E8>([</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>79</div></div><div class=code><span class=indent>    </span><span style=--0:#B392F0>fetchCollectionType</span><span style=--0:#E1E4E8>(</span><span style=--0:#79B8FF>3</span><span style=--0:#E1E4E8>),</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>80</div></div><div class=code><span class=indent>    </span><span style=--0:#B392F0>fetchCollectionType</span><span style=--0:#E1E4E8>(</span><span style=--0:#79B8FF>1</span><span style=--0:#E1E4E8>),</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>81</div></div><div class=code><span class=indent>    </span><span style=--0:#B392F0>fetchCollectionType</span><span style=--0:#E1E4E8>(</span><span style=--0:#79B8FF>2</span><span style=--0:#E1E4E8>),</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>82</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>  </span></span><span style=--0:#E1E4E8>]);</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>83</div></div><div class=code>
</div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>84</div></div><div class=code><span class=indent>  </span><span style=--0:#F97583>const</span><span style=--0:#E1E4E8> </span><span style=--0:#79B8FF>payload</span><span style=--0:#E1E4E8> </span><span style=--0:#F97583>=</span><span style=--0:#E1E4E8> { watching, wish, watched, cachedAt: now };</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>85</div></div><div class=code><span class=indent>  </span><span style=--0:#F97583>await</span><span style=--0:#E1E4E8> </span><span style=--0:#B392F0>writeCache</span><span style=--0:#E1E4E8>(payload).</span><span style=--0:#B392F0>catch</span><span style=--0:#E1E4E8>(() </span><span style=--0:#F97583>=></span><span style=--0:#E1E4E8> {});</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>86</div></div><div class=code><span class=indent>  </span><span style=--0:#F97583>return</span><span style=--0:#E1E4E8> </span><span style=--0:#F97583>new</span><span style=--0:#E1E4E8> </span><span style=--0:#B392F0>Response</span><span style=--0:#E1E4E8>(</span><span style=--0:#79B8FF>JSON</span><span style=--0:#E1E4E8>.</span><span style=--0:#B392F0>stringify</span><span style=--0:#E1E4E8>({ </span><span style=--0:#F97583>...</span><span style=--0:#E1E4E8>payload, servedFrom: force </span><span style=--0:#F97583>?</span><span style=--0:#E1E4E8> </span><span style=--0:#9ECBFF>"forced-fetch"</span><span style=--0:#E1E4E8> </span><span style=--0:#F97583>:</span><span style=--0:#E1E4E8> </span><span style=--0:#9ECBFF>"fetched"</span><span style=--0:#E1E4E8> }), {</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>87</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>    </span></span><span style=--0:#E1E4E8>status: </span><span style=--0:#79B8FF>200</span><span style=--0:#E1E4E8>,</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>88</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>    </span></span><span style=--0:#E1E4E8>headers: {</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>89</div></div><div class=code><span class=indent>      </span><span style=--0:#9ECBFF>"Content-Type"</span><span style=--0:#E1E4E8>: </span><span style=--0:#9ECBFF>"application/json"</span><span style=--0:#E1E4E8>,</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>90</div></div><div class=code><span class=indent>      </span><span style=--0:#99A0A6>// prevent CDN/browser caching so follow-up refreshes always consult the function</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>91</div></div><div class=code><span class=indent>      </span><span style=--0:#9ECBFF>"Cache-Control"</span><span style=--0:#E1E4E8>: </span><span style=--0:#9ECBFF>"no-store, max-age=0"</span><span style=--0:#E1E4E8>,</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>92</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>    </span></span><span style=--0:#E1E4E8>},</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>93</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>  </span></span><span style=--0:#E1E4E8>});</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>94</div></div><div class=code><span style=--0:#E1E4E8>};</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>95</div></div><div class=code><span style=--0:#99A0A6>// For SSR adapters, ensure this endpoint is executed at runtime and not pre-rendered</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>96</div></div><div class=code><span style=--0:#F97583>export</span><span style=--0:#E1E4E8> </span><span style=--0:#F97583>const</span><span style=--0:#E1E4E8> </span><span style=--0:#79B8FF>prerender</span><span style=--0:#E1E4E8> </span><span style=--0:#F97583>=</span><span style=--0:#E1E4E8> </span><span style=--0:#79B8FF>false</span><span style=--0:#E1E4E8>;</span></div></div></code></pre><div class=copy><button title="Copy to clipboard" data-code="import type { APIRoute } from &#x22;astro&#x22;;import fs from &#x22;node:fs/promises&#x22;;import path from &#x22;node:path&#x22;;import process from &#x22;node:process&#x22;;const username = &#x22;&#x22;;// 在这里填上@id的内容const baseUrl = &#x60;https://api.bgm.tv/v0/users/${username}/collections&#x60;;const CACHE_TTL_MS = 60 * 60 * 1000; // 这里是调用api的时间间隔，默认为60分钟// Use /tmp on Vercel/serverless (writable), otherwise local .cache directoryconst CACHE_DIR = process.env.VERCEL ? &#x22;/tmp&#x22; : path.resolve(process.cwd(), &#x22;.cache&#x22;);const CACHE_FILE = path.join(CACHE_DIR, &#x22;bangumi.json&#x22;);async function fetchCollectionType(type: number) {  let page = 1;  const limit = 30;  let all: any[] = [];  try {    while (true) {      const res = await fetch(&#x60;${baseUrl}?type=${type}&#x26;limit=${limit}&#x26;offset=${(page - 1) * limit}&#x60;, {        headers: { &#x22;User-Agent&#x22;: &#x22;AstroBlog/1.0 (https://yourblog.com)&#x22; },      });      if (!res.ok)        break;      const j = await res.json();      if (!j.data || j.data.length === 0)        break;      all = all.concat(j.data);      if (j.data.length < limit)        break;      page++;    }  }  catch (e) {    console.error(&#x22;fetchCollectionType error:&#x22;, e);  }  return all;}async function readCache() {  try {    const raw = await fs.readFile(CACHE_FILE, &#x22;utf-8&#x22;);    return JSON.parse(raw);  }  catch {    return null;  }}async function writeCache(obj: any) {  try {    await fs.mkdir(path.dirname(CACHE_FILE), { recursive: true });    await fs.writeFile(CACHE_FILE, JSON.stringify(obj), &#x22;utf-8&#x22;);  }  catch (e) {    console.warn(&#x22;writeCache failed:&#x22;, e);  }}export const GET: APIRoute = async ({ url }) => {  const force = url.searchParams.get(&#x22;force&#x22;) === &#x22;1&#x22; || url.searchParams.get(&#x22;refresh&#x22;) === &#x22;1&#x22;;  // Try read file cache unless force refresh requested  const now = Date.now();  if (!force) {    const fileCache = await readCache();    if (fileCache &#x26;&#x26; fileCache.cachedAt &#x26;&#x26; (now - fileCache.cachedAt) < CACHE_TTL_MS) {      return new Response(JSON.stringify({ ...fileCache, servedFrom: &#x22;file-cache&#x22; }), {        status: 200,        headers: {          &#x22;Content-Type&#x22;: &#x22;application/json&#x22;,          // prevent CDN/browser caching of this response to ensure client-side refresh always revalidates          &#x22;Cache-Control&#x22;: &#x22;no-store, max-age=0&#x22;,        },      });    }  }  // Otherwise fetch fresh (or partial) and save  const [watching, wish, watched] = await Promise.all([    fetchCollectionType(3),    fetchCollectionType(1),    fetchCollectionType(2),  ]);  const payload = { watching, wish, watched, cachedAt: now };  await writeCache(payload).catch(() => {});  return new Response(JSON.stringify({ ...payload, servedFrom: force ? &#x22;forced-fetch&#x22; : &#x22;fetched&#x22; }), {    status: 200,    headers: {      &#x22;Content-Type&#x22;: &#x22;application/json&#x22;,      // prevent CDN/browser caching so follow-up refreshes always consult the function      &#x22;Cache-Control&#x22;: &#x22;no-store, max-age=0&#x22;,    },  });};// For SSR adapters, ensure this endpoint is executed at runtime and not pre-renderedexport const prerender = false;" data-copied=Copied!><div></div></button></div></figure></div><p>以存放bangumi的api。</p><p>新建anime的页面，在astro里新建（hexo用md）anime.astro</p><div class=expressive-code><figure class=frame style=--lnWidth:3ch><figcaption class=header></figcaption><pre data-language=html><code><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>1</div></div><div class=code><span style=--0:#E1E4E8>---</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>2</div></div><div class=code><span style=--0:#E1E4E8>import BaseLayout from "@/layouts/BaseLayout.astro";</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>3</div></div><div class=code><span style=--0:#E1E4E8>import MainCard from "@/components/MainCard.astro";</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>4</div></div><div class=code><span style=--0:#E1E4E8>import { Icon } from "astro-icon/components";</span><span style=--0:#99A0A6>&#x3C;!--这里是博客的基本配置，不用管--></span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>5</div></div><div class=code>
</div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>6</div></div><div class=code><span style=--0:#E1E4E8>type Subject = {</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>7</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>  </span></span><span style=--0:#E1E4E8>id: number;</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>8</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>  </span></span><span style=--0:#E1E4E8>name: string;</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>9</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>  </span></span><span style=--0:#E1E4E8>name_cn?: string;</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>10</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>  </span></span><span style=--0:#E1E4E8>date?: string;</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>11</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>  </span></span><span style=--0:#E1E4E8>images?: { common?: string };</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>12</div></div><div class=code><span style=--0:#E1E4E8>};</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>13</div></div><div class=code><span style=--0:#E1E4E8>type WatchingItem = { subject: Subject };</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>14</div></div><div class=code>
</div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>15</div></div><div class=code><span style=--0:#E1E4E8>// remove server-side fetching so page is static-built and client will update</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>16</div></div><div class=code><span style=--0:#E1E4E8>---</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>17</div></div><div class=code>
</div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>18</div></div><div class=code><span style=--0:#E1E4E8>&#x3C;</span><span style=--0:#FDAEB7;--0fs:italic>BaseLayout</span><span style=--0:#E1E4E8> </span><span style=--0:#B392F0>title</span><span style=--0:#E1E4E8>=</span><span style=--0:#9ECBFF>"我的追番"</span><span style=--0:#E1E4E8>></span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>19</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>  </span></span><span style=--0:#E1E4E8>&#x3C;</span><span style=--0:#FDAEB7;--0fs:italic>MainCard</span><span style=--0:#E1E4E8> </span><span style=--0:#B392F0>title</span><span style=--0:#E1E4E8>=</span><span style=--0:#9ECBFF>"Anime"</span><span style=--0:#E1E4E8> </span><span style=--0:#B392F0>description</span><span style=--0:#E1E4E8>=</span><span style=--0:#9ECBFF>"追番记录"</span><span style=--0:#E1E4E8> </span><span style=--0:#B392F0>textOverlay</span><span style=--0:#E1E4E8>=</span><span style=--0:#9ECBFF>"Anime"</span><span style=--0:#E1E4E8> </span><span style=--0:#B392F0>infoIcon</span><span style=--0:#E1E4E8>=</span><span style=--0:#9ECBFF>"lucide:tv"</span><span style=--0:#E1E4E8>></span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>20</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>    </span></span><span style=--0:#E1E4E8>&#x3C;</span><span style=--0:#85E89D>div</span><span style=--0:#E1E4E8> </span><span style=--0:#B392F0>class</span><span style=--0:#E1E4E8>=</span><span style=--0:#9ECBFF>"space-y-4 mb-8 max-w-7xl mx-auto px-4"</span><span style=--0:#E1E4E8>></span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>21</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>      </span></span><span style=--0:#E1E4E8>&#x3C;</span><span style=--0:#85E89D>div</span><span style=--0:#E1E4E8> </span><span style=--0:#B392F0>class</span><span style=--0:#E1E4E8>=</span><span style=--0:#9ECBFF>"flex flex-col md:flex-row items-center justify-between gap-4"</span><span style=--0:#E1E4E8>></span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>22</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>        </span></span><span style=--0:#E1E4E8>&#x3C;</span><span style=--0:#85E89D>input</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>23</div></div><div class=code><span class=indent>          </span><span style=--0:#B392F0>type</span><span style=--0:#E1E4E8>=</span><span style=--0:#9ECBFF>"text"</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>24</div></div><div class=code><span class=indent>          </span><span style=--0:#B392F0>id</span><span style=--0:#E1E4E8>=</span><span style=--0:#9ECBFF>"search"</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>25</div></div><div class=code><span class=indent>          </span><span style=--0:#B392F0>placeholder</span><span style=--0:#E1E4E8>=</span><span style=--0:#9ECBFF>"搜索番剧..."</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>26</div></div><div class=code><span class=indent>          </span><span style=--0:#B392F0>class</span><span style=--0:#E1E4E8>=</span><span style=--0:#9ECBFF>"px-4 py-2 w-full md:w-64 rounded-full border border-gray-300 focus:border-blue-600 focus:ring-2 focus:ring-blue-200 outline-none transition"</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>27</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>        </span></span><span style=--0:#E1E4E8>/></span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>28</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>        </span></span><span style=--0:#E1E4E8>&#x3C;</span><span style=--0:#85E89D>div</span><span style=--0:#E1E4E8> </span><span style=--0:#B392F0>class</span><span style=--0:#E1E4E8>=</span><span style=--0:#9ECBFF>"flex items-center gap-2"</span><span style=--0:#E1E4E8>></span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>29</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>          </span></span><span style=--0:#E1E4E8>&#x3C;</span><span style=--0:#85E89D>div</span><span style=--0:#E1E4E8> </span><span style=--0:#B392F0>class</span><span style=--0:#E1E4E8>=</span><span style=--0:#9ECBFF>"flex gap-2"</span><span style=--0:#E1E4E8> </span><span style=--0:#B392F0>id</span><span style=--0:#E1E4E8>=</span><span style=--0:#9ECBFF>"tab-group"</span><span style=--0:#E1E4E8>></span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>30</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>            </span></span><span style=--0:#E1E4E8>&#x3C;</span><span style=--0:#85E89D>button</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>31</div></div><div class=code><span class=indent>              </span><span style=--0:#B392F0>data-tab</span><span style=--0:#E1E4E8>=</span><span style=--0:#9ECBFF>"watching"</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>32</div></div><div class=code><span class=indent>              </span><span style=--0:#B392F0>class</span><span style=--0:#E1E4E8>=</span><span style=--0:#9ECBFF>"tab-btn px-4 py-2 rounded-full bg-blue-600 text-white font-semibold shadow"</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>33</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>            </span></span><span style=--0:#E1E4E8>></span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>34</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>              </span></span><span style=--0:#E1E4E8>在看</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>35</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>            </span></span><span style=--0:#E1E4E8>&#x3C;/</span><span style=--0:#85E89D>button</span><span style=--0:#E1E4E8>></span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>36</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>            </span></span><span style=--0:#E1E4E8>&#x3C;</span><span style=--0:#85E89D>button</span><span style=--0:#E1E4E8> </span><span style=--0:#B392F0>data-tab</span><span style=--0:#E1E4E8>=</span><span style=--0:#9ECBFF>"wish"</span><span style=--0:#E1E4E8> </span><span style=--0:#B392F0>class</span><span style=--0:#E1E4E8>=</span><span style=--0:#9ECBFF>"tab-btn px-4 py-2 rounded-full bg-gray-200 text-gray-700 font-semibold"</span><span style=--0:#E1E4E8>></span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>37</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>              </span></span><span style=--0:#E1E4E8>想看</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>38</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>            </span></span><span style=--0:#E1E4E8>&#x3C;/</span><span style=--0:#85E89D>button</span><span style=--0:#E1E4E8>></span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>39</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>            </span></span><span style=--0:#E1E4E8>&#x3C;</span><span style=--0:#85E89D>button</span><span style=--0:#E1E4E8> </span><span style=--0:#B392F0>data-tab</span><span style=--0:#E1E4E8>=</span><span style=--0:#9ECBFF>"watched"</span><span style=--0:#E1E4E8> </span><span style=--0:#B392F0>class</span><span style=--0:#E1E4E8>=</span><span style=--0:#9ECBFF>"tab-btn px-4 py-2 rounded-full bg-gray-200 text-gray-700 font-semibold"</span><span style=--0:#E1E4E8>></span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>40</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>              </span></span><span style=--0:#E1E4E8>看过</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>41</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>            </span></span><span style=--0:#E1E4E8>&#x3C;/</span><span style=--0:#85E89D>button</span><span style=--0:#E1E4E8>></span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>42</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>          </span></span><span style=--0:#E1E4E8>&#x3C;/</span><span style=--0:#85E89D>div</span><span style=--0:#E1E4E8>></span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>43</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>          </span></span><span style=--0:#E1E4E8>&#x3C;</span><span style=--0:#85E89D>button</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>44</div></div><div class=code><span class=indent>            </span><span style=--0:#B392F0>id</span><span style=--0:#E1E4E8>=</span><span style=--0:#9ECBFF>"refresh-btn"</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>45</div></div><div class=code><span class=indent>            </span><span style=--0:#B392F0>title</span><span style=--0:#E1E4E8>=</span><span style=--0:#9ECBFF>"手动刷新"</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>46</div></div><div class=code><span class=indent>            </span><span style=--0:#B392F0>class</span><span style=--0:#E1E4E8>=</span><span style=--0:#9ECBFF>"px-4 py-2 rounded-full bg-gray-200 text-gray-700 font-semibold"</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>47</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>          </span></span><span style=--0:#E1E4E8>></span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>48</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>            </span></span><span style=--0:#E1E4E8>刷新</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>49</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>          </span></span><span style=--0:#E1E4E8>&#x3C;/</span><span style=--0:#85E89D>button</span><span style=--0:#E1E4E8>></span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>50</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>        </span></span><span style=--0:#E1E4E8>&#x3C;/</span><span style=--0:#85E89D>div</span><span style=--0:#E1E4E8>></span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>51</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>      </span></span><span style=--0:#E1E4E8>&#x3C;/</span><span style=--0:#85E89D>div</span><span style=--0:#E1E4E8>></span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>52</div></div><div class=code>
</div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>53</div></div><div class=code><span class=indent>      </span><span style=--0:#99A0A6>&#x3C;!-- 内容容器：初始为空，客户端填充 --></span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>54</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>      </span></span><span style=--0:#E1E4E8>&#x3C;</span><span style=--0:#85E89D>div</span><span style=--0:#E1E4E8> </span><span style=--0:#B392F0>id</span><span style=--0:#E1E4E8>=</span><span style=--0:#9ECBFF>"content-area"</span><span style=--0:#E1E4E8> </span><span style=--0:#B392F0>class</span><span style=--0:#E1E4E8>=</span><span style=--0:#9ECBFF>"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-6"</span><span style=--0:#E1E4E8>></span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>55</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>        </span></span><span style=--0:#E1E4E8>&#x3C;</span><span style=--0:#85E89D>div</span><span style=--0:#E1E4E8> </span><span style=--0:#B392F0>id</span><span style=--0:#E1E4E8>=</span><span style=--0:#9ECBFF>"loading-placeholder"</span><span style=--0:#E1E4E8> </span><span style=--0:#B392F0>class</span><span style=--0:#E1E4E8>=</span><span style=--0:#9ECBFF>"col-span-full text-center py-12 text-sm text-gray-500"</span><span style=--0:#E1E4E8>>Loading...&#x3C;/</span><span style=--0:#85E89D>div</span><span style=--0:#E1E4E8>></span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>56</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>      </span></span><span style=--0:#E1E4E8>&#x3C;/</span><span style=--0:#85E89D>div</span><span style=--0:#E1E4E8>></span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>57</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>    </span></span><span style=--0:#E1E4E8>&#x3C;/</span><span style=--0:#85E89D>div</span><span style=--0:#E1E4E8>></span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>58</div></div><div class=code>
</div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>59</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>    </span></span><span style=--0:#E1E4E8>&#x3C;</span><span style=--0:#85E89D>script</span><span style=--0:#E1E4E8> </span><span style=--0:#B392F0>type</span><span style=--0:#E1E4E8>=</span><span style=--0:#9ECBFF>"module"</span><span style=--0:#E1E4E8>></span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>60</div></div><div class=code><span class=indent>      </span><span style=--0:#F97583>const</span><span style=--0:#E1E4E8> </span><span style=--0:#79B8FF>API</span><span style=--0:#E1E4E8> </span><span style=--0:#F97583>=</span><span style=--0:#E1E4E8> </span><span style=--0:#9ECBFF>"/api/bangumi"</span><span style=--0:#E1E4E8>;</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>61</div></div><div class=code><span class=indent>      </span><span style=--0:#F97583>const</span><span style=--0:#E1E4E8> </span><span style=--0:#79B8FF>CACHE_KEY</span><span style=--0:#E1E4E8> </span><span style=--0:#F97583>=</span><span style=--0:#E1E4E8> </span><span style=--0:#9ECBFF>"bangumi_front_cache_v1"</span><span style=--0:#E1E4E8>;</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>62</div></div><div class=code><span class=indent>      </span><span style=--0:#F97583>const</span><span style=--0:#E1E4E8> </span><span style=--0:#79B8FF>CLIENT_TTL</span><span style=--0:#E1E4E8> </span><span style=--0:#F97583>=</span><span style=--0:#E1E4E8> </span><span style=--0:#79B8FF>60</span><span style=--0:#E1E4E8> </span><span style=--0:#F97583>*</span><span style=--0:#E1E4E8> </span><span style=--0:#79B8FF>60</span><span style=--0:#E1E4E8> </span><span style=--0:#F97583>*</span><span style=--0:#E1E4E8> </span><span style=--0:#79B8FF>1000</span><span style=--0:#E1E4E8>; </span><span style=--0:#99A0A6>// 1 hour client-side fallback cache</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>63</div></div><div class=code><span class=indent>      </span><span style=--0:#F97583>const</span><span style=--0:#E1E4E8> </span><span style=--0:#79B8FF>AUTO_REFRESH_MS</span><span style=--0:#E1E4E8> </span><span style=--0:#F97583>=</span><span style=--0:#E1E4E8> </span><span style=--0:#79B8FF>15</span><span style=--0:#E1E4E8> </span><span style=--0:#F97583>*</span><span style=--0:#E1E4E8> </span><span style=--0:#79B8FF>60</span><span style=--0:#E1E4E8> </span><span style=--0:#F97583>*</span><span style=--0:#E1E4E8> </span><span style=--0:#79B8FF>1000</span><span style=--0:#E1E4E8>; </span><span style=--0:#99A0A6>// auto refresh every 15 minutes</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>64</div></div><div class=code>
</div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>65</div></div><div class=code><span class=indent>      </span><span style=--0:#F97583>const</span><span style=--0:#E1E4E8> </span><span style=--0:#79B8FF>tabs</span><span style=--0:#E1E4E8> </span><span style=--0:#F97583>=</span><span style=--0:#E1E4E8> [</span><span style=--0:#9ECBFF>"watching"</span><span style=--0:#E1E4E8>, </span><span style=--0:#9ECBFF>"wish"</span><span style=--0:#E1E4E8>, </span><span style=--0:#9ECBFF>"watched"</span><span style=--0:#E1E4E8>];</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>66</div></div><div class=code><span class=indent>      </span><span style=--0:#F97583>let</span><span style=--0:#E1E4E8> currentTab </span><span style=--0:#F97583>=</span><span style=--0:#E1E4E8> </span><span style=--0:#9ECBFF>"watching"</span><span style=--0:#E1E4E8>;</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>67</div></div><div class=code><span class=indent>      </span><span style=--0:#F97583>let</span><span style=--0:#E1E4E8> dataStore </span><span style=--0:#F97583>=</span><span style=--0:#E1E4E8> { watching: [], wish: [], watched: [] };</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>68</div></div><div class=code>
</div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>69</div></div><div class=code><span class=indent>      </span><span style=--0:#F97583>const</span><span style=--0:#E1E4E8> </span><span style=--0:#79B8FF>searchInput</span><span style=--0:#E1E4E8> </span><span style=--0:#F97583>=</span><span style=--0:#E1E4E8> document.</span><span style=--0:#B392F0>getElementById</span><span style=--0:#E1E4E8>(</span><span style=--0:#9ECBFF>"search"</span><span style=--0:#E1E4E8>);</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>70</div></div><div class=code><span class=indent>      </span><span style=--0:#F97583>const</span><span style=--0:#E1E4E8> </span><span style=--0:#79B8FF>contentArea</span><span style=--0:#E1E4E8> </span><span style=--0:#F97583>=</span><span style=--0:#E1E4E8> document.</span><span style=--0:#B392F0>getElementById</span><span style=--0:#E1E4E8>(</span><span style=--0:#9ECBFF>"content-area"</span><span style=--0:#E1E4E8>);</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>71</div></div><div class=code><span class=indent>      </span><span style=--0:#F97583>const</span><span style=--0:#E1E4E8> </span><span style=--0:#79B8FF>refreshBtn</span><span style=--0:#E1E4E8> </span><span style=--0:#F97583>=</span><span style=--0:#E1E4E8> document.</span><span style=--0:#B392F0>getElementById</span><span style=--0:#E1E4E8>(</span><span style=--0:#9ECBFF>"refresh-btn"</span><span style=--0:#E1E4E8>);</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>72</div></div><div class=code>
</div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>73</div></div><div class=code><span class=indent>      </span><span style=--0:#F97583>function</span><span style=--0:#E1E4E8> </span><span style=--0:#B392F0>saveClientCache</span><span style=--0:#E1E4E8>(</span><span style=--0:#FFAB70>obj</span><span style=--0:#E1E4E8>) {</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>74</div></div><div class=code><span class=indent>        </span><span style=--0:#F97583>try</span><span style=--0:#E1E4E8> {</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>75</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>          </span></span><span style=--0:#E1E4E8>localStorage.</span><span style=--0:#B392F0>setItem</span><span style=--0:#E1E4E8>(</span><span style=--0:#79B8FF>CACHE_KEY</span><span style=--0:#E1E4E8>, </span><span style=--0:#79B8FF>JSON</span><span style=--0:#E1E4E8>.</span><span style=--0:#B392F0>stringify</span><span style=--0:#E1E4E8>({ data: obj, ts: Date.</span><span style=--0:#B392F0>now</span><span style=--0:#E1E4E8>() }));</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>76</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>        </span></span><span style=--0:#E1E4E8>} </span><span style=--0:#F97583>catch</span><span style=--0:#E1E4E8> (e) {</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>77</div></div><div class=code><span class=indent>          </span><span style=--0:#99A0A6>/* ignore */</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>78</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>        </span></span><span style=--0:#E1E4E8>}</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>79</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>      </span></span><span style=--0:#E1E4E8>}</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>80</div></div><div class=code><span class=indent>      </span><span style=--0:#F97583>function</span><span style=--0:#E1E4E8> </span><span style=--0:#B392F0>readClientCache</span><span style=--0:#E1E4E8>() {</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>81</div></div><div class=code><span class=indent>        </span><span style=--0:#F97583>try</span><span style=--0:#E1E4E8> {</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>82</div></div><div class=code><span class=indent>          </span><span style=--0:#F97583>const</span><span style=--0:#E1E4E8> </span><span style=--0:#79B8FF>raw</span><span style=--0:#E1E4E8> </span><span style=--0:#F97583>=</span><span style=--0:#E1E4E8> localStorage.</span><span style=--0:#B392F0>getItem</span><span style=--0:#E1E4E8>(</span><span style=--0:#79B8FF>CACHE_KEY</span><span style=--0:#E1E4E8>);</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>83</div></div><div class=code><span class=indent>          </span><span style=--0:#F97583>if</span><span style=--0:#E1E4E8> (</span><span style=--0:#F97583>!</span><span style=--0:#E1E4E8>raw) </span><span style=--0:#F97583>return</span><span style=--0:#E1E4E8> </span><span style=--0:#79B8FF>null</span><span style=--0:#E1E4E8>;</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>84</div></div><div class=code><span class=indent>          </span><span style=--0:#F97583>const</span><span style=--0:#E1E4E8> </span><span style=--0:#79B8FF>parsed</span><span style=--0:#E1E4E8> </span><span style=--0:#F97583>=</span><span style=--0:#E1E4E8> </span><span style=--0:#79B8FF>JSON</span><span style=--0:#E1E4E8>.</span><span style=--0:#B392F0>parse</span><span style=--0:#E1E4E8>(raw);</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>85</div></div><div class=code><span class=indent>          </span><span style=--0:#F97583>if</span><span style=--0:#E1E4E8> (Date.</span><span style=--0:#B392F0>now</span><span style=--0:#E1E4E8>() </span><span style=--0:#F97583>-</span><span style=--0:#E1E4E8> parsed.ts </span><span style=--0:#F97583>></span><span style=--0:#E1E4E8> </span><span style=--0:#79B8FF>CLIENT_TTL</span><span style=--0:#E1E4E8>) </span><span style=--0:#F97583>return</span><span style=--0:#E1E4E8> </span><span style=--0:#79B8FF>null</span><span style=--0:#E1E4E8>;</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>86</div></div><div class=code><span class=indent>          </span><span style=--0:#F97583>return</span><span style=--0:#E1E4E8> parsed.data;</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>87</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>        </span></span><span style=--0:#E1E4E8>} </span><span style=--0:#F97583>catch</span><span style=--0:#E1E4E8> {</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>88</div></div><div class=code><span class=indent>          </span><span style=--0:#F97583>return</span><span style=--0:#E1E4E8> </span><span style=--0:#79B8FF>null</span><span style=--0:#E1E4E8>;</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>89</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>        </span></span><span style=--0:#E1E4E8>}</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>90</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>      </span></span><span style=--0:#E1E4E8>}</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>91</div></div><div class=code>
</div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>92</div></div><div class=code><span class=indent>      </span><span style=--0:#F97583>async</span><span style=--0:#E1E4E8> </span><span style=--0:#F97583>function</span><span style=--0:#E1E4E8> </span><span style=--0:#B392F0>fetchFromApi</span><span style=--0:#E1E4E8>(</span><span style=--0:#FFAB70>force</span><span style=--0:#E1E4E8> </span><span style=--0:#F97583>=</span><span style=--0:#E1E4E8> </span><span style=--0:#79B8FF>false</span><span style=--0:#E1E4E8>) {</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>93</div></div><div class=code><span class=indent>        </span><span style=--0:#99A0A6>// If not forced, try client cache first</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>94</div></div><div class=code><span class=indent>        </span><span style=--0:#F97583>if</span><span style=--0:#E1E4E8> (</span><span style=--0:#F97583>!</span><span style=--0:#E1E4E8>force) {</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>95</div></div><div class=code><span class=indent>          </span><span style=--0:#F97583>const</span><span style=--0:#E1E4E8> </span><span style=--0:#79B8FF>cached</span><span style=--0:#E1E4E8> </span><span style=--0:#F97583>=</span><span style=--0:#E1E4E8> </span><span style=--0:#B392F0>readClientCache</span><span style=--0:#E1E4E8>();</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>96</div></div><div class=code><span class=indent>          </span><span style=--0:#F97583>if</span><span style=--0:#E1E4E8> (cached) {</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>97</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>            </span></span><span style=--0:#E1E4E8>dataStore </span><span style=--0:#F97583>=</span><span style=--0:#E1E4E8> cached;</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>98</div></div><div class=code><span class=indent>            </span><span style=--0:#B392F0>renderCurrent</span><span style=--0:#E1E4E8>();</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>99</div></div><div class=code><span class=indent>            </span><span style=--0:#99A0A6>// still refresh in background if staled? we'll continue to fetch but don't block UI</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>100</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>          </span></span><span style=--0:#E1E4E8>}</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>101</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>        </span></span><span style=--0:#E1E4E8>}</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>102</div></div><div class=code>
</div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>103</div></div><div class=code><span class=indent>        </span><span style=--0:#F97583>try</span><span style=--0:#E1E4E8> {</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>104</div></div><div class=code><span class=indent>          </span><span style=--0:#99A0A6>// Add cache-busting param and optional force flag so server bypasses cache</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>105</div></div><div class=code><span class=indent>          </span><span style=--0:#F97583>const</span><span style=--0:#E1E4E8> </span><span style=--0:#79B8FF>url</span><span style=--0:#E1E4E8> </span><span style=--0:#F97583>=</span><span style=--0:#E1E4E8> </span><span style=--0:#9ECBFF>`${</span><span style=--0:#79B8FF>API</span><span style=--0:#9ECBFF>}?t=${</span><span style=--0:#E1E4E8>Date</span><span style=--0:#9ECBFF>.</span><span style=--0:#B392F0>now</span><span style=--0:#9ECBFF>()</span><span style=--0:#9ECBFF>}${</span><span style=--0:#E1E4E8>force</span><span style=--0:#9ECBFF> </span><span style=--0:#F97583>?</span><span style=--0:#9ECBFF> </span><span style=--0:#9ECBFF>"&#x26;force=1"</span><span style=--0:#9ECBFF> </span><span style=--0:#F97583>:</span><span style=--0:#9ECBFF> </span><span style=--0:#9ECBFF>""}`</span><span style=--0:#E1E4E8>;</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>106</div></div><div class=code><span class=indent>          </span><span style=--0:#F97583>const</span><span style=--0:#E1E4E8> </span><span style=--0:#79B8FF>res</span><span style=--0:#E1E4E8> </span><span style=--0:#F97583>=</span><span style=--0:#E1E4E8> </span><span style=--0:#F97583>await</span><span style=--0:#E1E4E8> </span><span style=--0:#B392F0>fetch</span><span style=--0:#E1E4E8>(url, { cache: </span><span style=--0:#9ECBFF>"no-store"</span><span style=--0:#E1E4E8> });</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>107</div></div><div class=code><span class=indent>          </span><span style=--0:#F97583>if</span><span style=--0:#E1E4E8> (</span><span style=--0:#F97583>!</span><span style=--0:#E1E4E8>res.ok) </span><span style=--0:#F97583>throw</span><span style=--0:#E1E4E8> </span><span style=--0:#F97583>new</span><span style=--0:#E1E4E8> </span><span style=--0:#B392F0>Error</span><span style=--0:#E1E4E8>(</span><span style=--0:#9ECBFF>"fetch failed "</span><span style=--0:#E1E4E8> </span><span style=--0:#F97583>+</span><span style=--0:#E1E4E8> res.status);</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>108</div></div><div class=code><span class=indent>          </span><span style=--0:#F97583>const</span><span style=--0:#E1E4E8> </span><span style=--0:#79B8FF>json</span><span style=--0:#E1E4E8> </span><span style=--0:#F97583>=</span><span style=--0:#E1E4E8> </span><span style=--0:#F97583>await</span><span style=--0:#E1E4E8> res.</span><span style=--0:#B392F0>json</span><span style=--0:#E1E4E8>();</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>109</div></div><div class=code><span class=indent>          </span><span style=--0:#99A0A6>// server returns { watching, wish, watched, cachedAt }</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>110</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>          </span></span><span style=--0:#E1E4E8>dataStore </span><span style=--0:#F97583>=</span><span style=--0:#E1E4E8> {</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>111</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>            </span></span><span style=--0:#E1E4E8>watching: json.watching </span><span style=--0:#F97583>||</span><span style=--0:#E1E4E8> [],</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>112</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>            </span></span><span style=--0:#E1E4E8>wish: json.wish </span><span style=--0:#F97583>||</span><span style=--0:#E1E4E8> [],</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>113</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>            </span></span><span style=--0:#E1E4E8>watched: json.watched </span><span style=--0:#F97583>||</span><span style=--0:#E1E4E8> [],</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>114</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>          </span></span><span style=--0:#E1E4E8>};</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>115</div></div><div class=code><span class=indent>          </span><span style=--0:#B392F0>saveClientCache</span><span style=--0:#E1E4E8>(dataStore);</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>116</div></div><div class=code><span class=indent>          </span><span style=--0:#B392F0>renderCurrent</span><span style=--0:#E1E4E8>();</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>117</div></div><div class=code><span class=indent>          </span><span style=--0:#F97583>return</span><span style=--0:#E1E4E8> </span><span style=--0:#79B8FF>true</span><span style=--0:#E1E4E8>;</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>118</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>        </span></span><span style=--0:#E1E4E8>} </span><span style=--0:#F97583>catch</span><span style=--0:#E1E4E8> (e) {</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>119</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>          </span></span><span style=--0:#E1E4E8>console.</span><span style=--0:#B392F0>warn</span><span style=--0:#E1E4E8>(</span><span style=--0:#9ECBFF>"Bangumi API fetch failed:"</span><span style=--0:#E1E4E8>, e);</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>120</div></div><div class=code><span class=indent>          </span><span style=--0:#99A0A6>// if nothing in UI (from cache) and client cache missing, show error</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>121</div></div><div class=code><span class=indent>          </span><span style=--0:#F97583>if</span><span style=--0:#E1E4E8> (</span><span style=--0:#F97583>!</span><span style=--0:#E1E4E8>dataStore.watching.</span><span style=--0:#79B8FF>length</span><span style=--0:#E1E4E8> </span><span style=--0:#F97583>&#x26;&#x26;</span><span style=--0:#E1E4E8> </span><span style=--0:#F97583>!</span><span style=--0:#E1E4E8>dataStore.wish.</span><span style=--0:#79B8FF>length</span><span style=--0:#E1E4E8> </span><span style=--0:#F97583>&#x26;&#x26;</span><span style=--0:#E1E4E8> </span><span style=--0:#F97583>!</span><span style=--0:#E1E4E8>dataStore.watched.</span><span style=--0:#79B8FF>length</span><span style=--0:#E1E4E8>) {</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>122</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>            </span></span><span style=--0:#E1E4E8>contentArea.innerHTML </span><span style=--0:#F97583>=</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>123</div></div><div class=code><span class=indent>              </span><span style=--0:#9ECBFF>'&#x3C;div class="col-span-full text-center py-8 text-sm text-red-500">无法加载番剧数据，请稍后再试。&#x3C;/div>'</span><span style=--0:#E1E4E8>;</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>124</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>          </span></span><span style=--0:#E1E4E8>}</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>125</div></div><div class=code><span class=indent>          </span><span style=--0:#F97583>return</span><span style=--0:#E1E4E8> </span><span style=--0:#79B8FF>false</span><span style=--0:#E1E4E8>;</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>126</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>        </span></span><span style=--0:#E1E4E8>}</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>127</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>      </span></span><span style=--0:#E1E4E8>}</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>128</div></div><div class=code>
</div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>129</div></div><div class=code><span class=indent>      </span><span style=--0:#F97583>function</span><span style=--0:#E1E4E8> </span><span style=--0:#B392F0>renderCard</span><span style=--0:#E1E4E8>(</span><span style=--0:#FFAB70>item</span><span style=--0:#E1E4E8>) {</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>130</div></div><div class=code><span class=indent>        </span><span style=--0:#F97583>const</span><span style=--0:#E1E4E8> </span><span style=--0:#79B8FF>title</span><span style=--0:#E1E4E8> </span><span style=--0:#F97583>=</span><span style=--0:#E1E4E8> (item.subject.name_cn </span><span style=--0:#F97583>||</span><span style=--0:#E1E4E8> item.subject.name </span><span style=--0:#F97583>||</span><span style=--0:#E1E4E8> </span><span style=--0:#9ECBFF>""</span><span style=--0:#E1E4E8>).</span><span style=--0:#B392F0>replace</span><span style=--0:#E1E4E8>(</span><span style=--0:#9ECBFF>/</span><span style=--0:#DBEDFF>"</span><span style=--0:#9ECBFF>/</span><span style=--0:#F97583>g</span><span style=--0:#E1E4E8>, </span><span style=--0:#9ECBFF>"&#x26;quot;"</span><span style=--0:#E1E4E8>);</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>131</div></div><div class=code><span class=indent>        </span><span style=--0:#F97583>const</span><span style=--0:#E1E4E8> </span><span style=--0:#79B8FF>img</span><span style=--0:#E1E4E8> </span><span style=--0:#F97583>=</span><span style=--0:#E1E4E8> item.subject.images?.common;</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>132</div></div><div class=code><span class=indent>        </span><span style=--0:#F97583>const</span><span style=--0:#E1E4E8> </span><span style=--0:#79B8FF>id</span><span style=--0:#E1E4E8> </span><span style=--0:#F97583>=</span><span style=--0:#E1E4E8> item.subject.id;</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>133</div></div><div class=code><span class=indent>        </span><span style=--0:#F97583>const</span><span style=--0:#E1E4E8> </span><span style=--0:#79B8FF>date</span><span style=--0:#E1E4E8> </span><span style=--0:#F97583>=</span><span style=--0:#E1E4E8> item.subject.date </span><span style=--0:#F97583>?</span><span style=--0:#E1E4E8> </span><span style=--0:#9ECBFF>`&#x3C;p class="text-xs text-gray-500 mb-2">${</span><span style=--0:#E1E4E8>item</span><span style=--0:#9ECBFF>.</span><span style=--0:#E1E4E8>subject</span><span style=--0:#9ECBFF>.</span><span style=--0:#E1E4E8>date</span><span style=--0:#9ECBFF>}&#x3C;/p>`</span><span style=--0:#E1E4E8> </span><span style=--0:#F97583>:</span><span style=--0:#E1E4E8> </span><span style=--0:#9ECBFF>""</span><span style=--0:#E1E4E8>;</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>134</div></div><div class=code><span class=indent>        </span><span style=--0:#F97583>return</span><span style=--0:#E1E4E8> </span><span style=--0:#9ECBFF>`</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>135</div></div><div class=code><span class=indent><span style=--0:#9ECBFF>          </span></span><span style=--0:#9ECBFF>&#x3C;div class="card bg-white rounded-xl shadow hover:shadow-lg transform hover:-translate-y-1 transition overflow-hidden text-center" data-name="${</span><span style=--0:#9ECBFF>(</span><span style=--0:#E1E4E8>title</span><span style=--0:#9ECBFF> </span><span style=--0:#F97583>||</span><span style=--0:#9ECBFF> </span><span style=--0:#9ECBFF>""</span><span style=--0:#9ECBFF>).</span><span style=--0:#B392F0>toLowerCase</span><span style=--0:#9ECBFF>()</span><span style=--0:#9ECBFF>}"></span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>136</div></div><div class=code><span class=indent><span style=--0:#9ECBFF>            </span></span><span style=--0:#9ECBFF>${</span><span style=--0:#E1E4E8>img</span><span style=--0:#9ECBFF> </span><span style=--0:#F97583>?</span><span style=--0:#9ECBFF> </span><span style=--0:#9ECBFF>`&#x3C;a href="https://bgm.tv/subject/${</span><span style=--0:#E1E4E8>id</span><span style=--0:#9ECBFF>}" target="_blank" rel="noopener noreferrer">&#x3C;img src="${</span><span style=--0:#E1E4E8>img</span><span style=--0:#9ECBFF>}" alt="${</span><span style=--0:#E1E4E8>title</span><span style=--0:#9ECBFF>}" class="w-full h-48 md:h-56 lg:h-60 object-cover rounded-t-xl" loading="lazy" />&#x3C;/a>`</span><span style=--0:#9ECBFF> </span><span style=--0:#F97583>:</span><span style=--0:#9ECBFF> </span><span style=--0:#9ECBFF>""}</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>137</div></div><div class=code><span class=indent><span style=--0:#9ECBFF>            </span></span><span style=--0:#9ECBFF>&#x3C;h3 class="mt-2 text-sm font-medium truncate px-2">${</span><span style=--0:#E1E4E8>title</span><span style=--0:#9ECBFF>}&#x3C;/h3></span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>138</div></div><div class=code><span class=indent><span style=--0:#9ECBFF>            </span></span><span style=--0:#9ECBFF>${</span><span style=--0:#E1E4E8>date</span><span style=--0:#9ECBFF>}</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>139</div></div><div class=code><span class=indent><span style=--0:#9ECBFF>          </span></span><span style=--0:#9ECBFF>&#x3C;/div></span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>140</div></div><div class=code><span class=indent><span style=--0:#9ECBFF>        </span></span><span style=--0:#9ECBFF>`</span><span style=--0:#E1E4E8>;</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>141</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>      </span></span><span style=--0:#E1E4E8>}</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>142</div></div><div class=code>
</div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>143</div></div><div class=code><span class=indent>      </span><span style=--0:#F97583>function</span><span style=--0:#E1E4E8> </span><span style=--0:#B392F0>renderCurrent</span><span style=--0:#E1E4E8>() {</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>144</div></div><div class=code><span class=indent>        </span><span style=--0:#F97583>const</span><span style=--0:#E1E4E8> </span><span style=--0:#79B8FF>list</span><span style=--0:#E1E4E8> </span><span style=--0:#F97583>=</span><span style=--0:#E1E4E8> dataStore[currentTab] </span><span style=--0:#F97583>||</span><span style=--0:#E1E4E8> [];</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>145</div></div><div class=code><span class=indent>        </span><span style=--0:#F97583>const</span><span style=--0:#E1E4E8> </span><span style=--0:#79B8FF>term</span><span style=--0:#E1E4E8> </span><span style=--0:#F97583>=</span><span style=--0:#E1E4E8> (searchInput.value </span><span style=--0:#F97583>||</span><span style=--0:#E1E4E8> </span><span style=--0:#9ECBFF>""</span><span style=--0:#E1E4E8>).</span><span style=--0:#B392F0>toLowerCase</span><span style=--0:#E1E4E8>();</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>146</div></div><div class=code><span class=indent>        </span><span style=--0:#99A0A6>// Only show 'no content' if data has been loaded and the list is empty.</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>147</div></div><div class=code><span class=indent>        </span><span style=--0:#99A0A6>// If dataStore is empty, it means we are still in the initial loading phase.</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>148</div></div><div class=code><span class=indent>        </span><span style=--0:#F97583>if</span><span style=--0:#E1E4E8> (</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>149</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>          </span></span><span style=--0:#E1E4E8>list.</span><span style=--0:#79B8FF>length</span><span style=--0:#E1E4E8> </span><span style=--0:#F97583>===</span><span style=--0:#E1E4E8> </span><span style=--0:#79B8FF>0</span><span style=--0:#E1E4E8> </span><span style=--0:#F97583>&#x26;&#x26;</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>150</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>          </span></span><span style=--0:#E1E4E8>(dataStore.watching.</span><span style=--0:#79B8FF>length</span><span style=--0:#E1E4E8> </span><span style=--0:#F97583>></span><span style=--0:#E1E4E8> </span><span style=--0:#79B8FF>0</span><span style=--0:#E1E4E8> </span><span style=--0:#F97583>||</span><span style=--0:#E1E4E8> dataStore.wish.</span><span style=--0:#79B8FF>length</span><span style=--0:#E1E4E8> </span><span style=--0:#F97583>></span><span style=--0:#E1E4E8> </span><span style=--0:#79B8FF>0</span><span style=--0:#E1E4E8> </span><span style=--0:#F97583>||</span><span style=--0:#E1E4E8> dataStore.watched.</span><span style=--0:#79B8FF>length</span><span style=--0:#E1E4E8> </span><span style=--0:#F97583>></span><span style=--0:#E1E4E8> </span><span style=--0:#79B8FF>0</span><span style=--0:#E1E4E8>)</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>151</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>        </span></span><span style=--0:#E1E4E8>) {</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>152</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>          </span></span><span style=--0:#E1E4E8>contentArea.innerHTML </span><span style=--0:#F97583>=</span><span style=--0:#E1E4E8> </span><span style=--0:#9ECBFF>'&#x3C;div class="col-span-full text-center py-8 text-sm text-gray-500">暂无内容&#x3C;/div>'</span><span style=--0:#E1E4E8>;</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>153</div></div><div class=code><span class=indent>          </span><span style=--0:#F97583>return</span><span style=--0:#E1E4E8>;</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>154</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>        </span></span><span style=--0:#E1E4E8>}</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>155</div></div><div class=code><span class=indent>        </span><span style=--0:#F97583>if</span><span style=--0:#E1E4E8> (list.</span><span style=--0:#79B8FF>length</span><span style=--0:#E1E4E8> </span><span style=--0:#F97583>></span><span style=--0:#E1E4E8> </span><span style=--0:#79B8FF>0</span><span style=--0:#E1E4E8>) {</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>156</div></div><div class=code><span class=indent>          </span><span style=--0:#F97583>const</span><span style=--0:#E1E4E8> </span><span style=--0:#79B8FF>html</span><span style=--0:#E1E4E8> </span><span style=--0:#F97583>=</span><span style=--0:#E1E4E8> list.</span><span style=--0:#B392F0>map</span><span style=--0:#E1E4E8>((</span><span style=--0:#FFAB70>item</span><span style=--0:#E1E4E8>) </span><span style=--0:#F97583>=></span><span style=--0:#E1E4E8> </span><span style=--0:#B392F0>renderCard</span><span style=--0:#E1E4E8>(item)).</span><span style=--0:#B392F0>join</span><span style=--0:#E1E4E8>(</span><span style=--0:#9ECBFF>""</span><span style=--0:#E1E4E8>);</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>157</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>          </span></span><span style=--0:#E1E4E8>contentArea.innerHTML </span><span style=--0:#F97583>=</span><span style=--0:#E1E4E8> html;</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>158</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>        </span></span><span style=--0:#E1E4E8>}</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>159</div></div><div class=code><span class=indent>        </span><span style=--0:#99A0A6>// apply search filter</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>160</div></div><div class=code><span class=indent>        </span><span style=--0:#F97583>if</span><span style=--0:#E1E4E8> (term) {</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>161</div></div><div class=code><span class=indent>          </span><span style=--0:#F97583>const</span><span style=--0:#E1E4E8> </span><span style=--0:#79B8FF>cards</span><span style=--0:#E1E4E8> </span><span style=--0:#F97583>=</span><span style=--0:#E1E4E8> contentArea.</span><span style=--0:#B392F0>querySelectorAll</span><span style=--0:#E1E4E8>(</span><span style=--0:#9ECBFF>"[data-name]"</span><span style=--0:#E1E4E8>);</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>162</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>          </span></span><span style=--0:#E1E4E8>cards.</span><span style=--0:#B392F0>forEach</span><span style=--0:#E1E4E8>((</span><span style=--0:#FFAB70>c</span><span style=--0:#E1E4E8>) </span><span style=--0:#F97583>=></span><span style=--0:#E1E4E8> {</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>163</div></div><div class=code><span class=indent>            </span><span style=--0:#F97583>const</span><span style=--0:#E1E4E8> </span><span style=--0:#79B8FF>name</span><span style=--0:#E1E4E8> </span><span style=--0:#F97583>=</span><span style=--0:#E1E4E8> c.</span><span style=--0:#B392F0>getAttribute</span><span style=--0:#E1E4E8>(</span><span style=--0:#9ECBFF>"data-name"</span><span style=--0:#E1E4E8>) </span><span style=--0:#F97583>||</span><span style=--0:#E1E4E8> </span><span style=--0:#9ECBFF>""</span><span style=--0:#E1E4E8>;</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>164</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>            </span></span><span style=--0:#E1E4E8>c.classList.</span><span style=--0:#B392F0>toggle</span><span style=--0:#E1E4E8>(</span><span style=--0:#9ECBFF>"hidden"</span><span style=--0:#E1E4E8>, </span><span style=--0:#F97583>!</span><span style=--0:#E1E4E8>name.</span><span style=--0:#B392F0>includes</span><span style=--0:#E1E4E8>(term));</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>165</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>          </span></span><span style=--0:#E1E4E8>});</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>166</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>        </span></span><span style=--0:#E1E4E8>}</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>167</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>      </span></span><span style=--0:#E1E4E8>}</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>168</div></div><div class=code>
</div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>169</div></div><div class=code><span class=indent>      </span><span style=--0:#99A0A6>// tabs UI: simple CSS class change and switching currentTab</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>170</div></div><div class=code><span class=indent>      </span><span style=--0:#F97583>function</span><span style=--0:#E1E4E8> </span><span style=--0:#B392F0>setActiveTab</span><span style=--0:#E1E4E8>(</span><span style=--0:#FFAB70>tab</span><span style=--0:#E1E4E8>) {</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>171</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>        </span></span><span style=--0:#E1E4E8>currentTab </span><span style=--0:#F97583>=</span><span style=--0:#E1E4E8> tab;</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>172</div></div><div class=code><span class=indent>        </span><span style=--0:#99A0A6>// update button styles</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>173</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>        </span></span><span style=--0:#E1E4E8>document.</span><span style=--0:#B392F0>querySelectorAll</span><span style=--0:#E1E4E8>(</span><span style=--0:#9ECBFF>".tab-btn"</span><span style=--0:#E1E4E8>).</span><span style=--0:#B392F0>forEach</span><span style=--0:#E1E4E8>((</span><span style=--0:#FFAB70>b</span><span style=--0:#E1E4E8>) </span><span style=--0:#F97583>=></span><span style=--0:#E1E4E8> {</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>174</div></div><div class=code><span class=indent>          </span><span style=--0:#F97583>if</span><span style=--0:#E1E4E8> (b.dataset.tab </span><span style=--0:#F97583>===</span><span style=--0:#E1E4E8> tab) {</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>175</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>            </span></span><span style=--0:#E1E4E8>b.classList.</span><span style=--0:#B392F0>add</span><span style=--0:#E1E4E8>(</span><span style=--0:#9ECBFF>"bg-blue-600"</span><span style=--0:#E1E4E8>, </span><span style=--0:#9ECBFF>"text-white"</span><span style=--0:#E1E4E8>, </span><span style=--0:#9ECBFF>"shadow"</span><span style=--0:#E1E4E8>);</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>176</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>            </span></span><span style=--0:#E1E4E8>b.classList.</span><span style=--0:#B392F0>remove</span><span style=--0:#E1E4E8>(</span><span style=--0:#9ECBFF>"bg-gray-200"</span><span style=--0:#E1E4E8>, </span><span style=--0:#9ECBFF>"text-gray-700"</span><span style=--0:#E1E4E8>);</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>177</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>          </span></span><span style=--0:#E1E4E8>} </span><span style=--0:#F97583>else</span><span style=--0:#E1E4E8> {</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>178</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>            </span></span><span style=--0:#E1E4E8>b.classList.</span><span style=--0:#B392F0>remove</span><span style=--0:#E1E4E8>(</span><span style=--0:#9ECBFF>"bg-blue-600"</span><span style=--0:#E1E4E8>, </span><span style=--0:#9ECBFF>"text-white"</span><span style=--0:#E1E4E8>, </span><span style=--0:#9ECBFF>"shadow"</span><span style=--0:#E1E4E8>);</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>179</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>            </span></span><span style=--0:#E1E4E8>b.classList.</span><span style=--0:#B392F0>add</span><span style=--0:#E1E4E8>(</span><span style=--0:#9ECBFF>"bg-gray-200"</span><span style=--0:#E1E4E8>, </span><span style=--0:#9ECBFF>"text-gray-700"</span><span style=--0:#E1E4E8>);</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>180</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>          </span></span><span style=--0:#E1E4E8>}</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>181</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>        </span></span><span style=--0:#E1E4E8>});</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>182</div></div><div class=code><span class=indent>        </span><span style=--0:#B392F0>renderCurrent</span><span style=--0:#E1E4E8>();</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>183</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>      </span></span><span style=--0:#E1E4E8>}</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>184</div></div><div class=code>
</div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>185</div></div><div class=code><span class=indent>      </span><span style=--0:#99A0A6>// Attach tab buttons</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>186</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>      </span></span><span style=--0:#E1E4E8>document.</span><span style=--0:#B392F0>querySelectorAll</span><span style=--0:#E1E4E8>(</span><span style=--0:#9ECBFF>"#tab-group .tab-btn"</span><span style=--0:#E1E4E8>).</span><span style=--0:#B392F0>forEach</span><span style=--0:#E1E4E8>((</span><span style=--0:#FFAB70>b</span><span style=--0:#E1E4E8>) </span><span style=--0:#F97583>=></span><span style=--0:#E1E4E8> {</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>187</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>        </span></span><span style=--0:#E1E4E8>b.</span><span style=--0:#B392F0>addEventListener</span><span style=--0:#E1E4E8>(</span><span style=--0:#9ECBFF>"click"</span><span style=--0:#E1E4E8>, () </span><span style=--0:#F97583>=></span><span style=--0:#E1E4E8> </span><span style=--0:#B392F0>setActiveTab</span><span style=--0:#E1E4E8>(b.dataset.tab));</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>188</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>      </span></span><span style=--0:#E1E4E8>});</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>189</div></div><div class=code>
</div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>190</div></div><div class=code><span class=indent>      </span><span style=--0:#99A0A6>// Search</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>191</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>      </span></span><span style=--0:#E1E4E8>searchInput.</span><span style=--0:#B392F0>addEventListener</span><span style=--0:#E1E4E8>(</span><span style=--0:#9ECBFF>"input"</span><span style=--0:#E1E4E8>, () </span><span style=--0:#F97583>=></span><span style=--0:#E1E4E8> </span><span style=--0:#B392F0>renderCurrent</span><span style=--0:#E1E4E8>());</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>192</div></div><div class=code>
</div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>193</div></div><div class=code><span class=indent>      </span><span style=--0:#99A0A6>// Refresh button</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>194</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>      </span></span><span style=--0:#E1E4E8>refreshBtn.</span><span style=--0:#B392F0>addEventListener</span><span style=--0:#E1E4E8>(</span><span style=--0:#9ECBFF>"click"</span><span style=--0:#E1E4E8>, </span><span style=--0:#F97583>async</span><span style=--0:#E1E4E8> () </span><span style=--0:#F97583>=></span><span style=--0:#E1E4E8> {</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>195</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>        </span></span><span style=--0:#E1E4E8>refreshBtn.textContent </span><span style=--0:#F97583>=</span><span style=--0:#E1E4E8> </span><span style=--0:#9ECBFF>"刷新中…"</span><span style=--0:#E1E4E8>;</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>196</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>        </span></span><span style=--0:#E1E4E8>refreshBtn.disabled </span><span style=--0:#F97583>=</span><span style=--0:#E1E4E8> </span><span style=--0:#79B8FF>true</span><span style=--0:#E1E4E8>;</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>197</div></div><div class=code><span class=indent>        </span><span style=--0:#F97583>await</span><span style=--0:#E1E4E8> </span><span style=--0:#B392F0>fetchFromApi</span><span style=--0:#E1E4E8>(</span><span style=--0:#79B8FF>true</span><span style=--0:#E1E4E8>);</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>198</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>        </span></span><span style=--0:#E1E4E8>refreshBtn.textContent </span><span style=--0:#F97583>=</span><span style=--0:#E1E4E8> </span><span style=--0:#9ECBFF>"刷新"</span><span style=--0:#E1E4E8>;</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>199</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>        </span></span><span style=--0:#E1E4E8>refreshBtn.disabled </span><span style=--0:#F97583>=</span><span style=--0:#E1E4E8> </span><span style=--0:#79B8FF>false</span><span style=--0:#E1E4E8>;</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>200</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>      </span></span><span style=--0:#E1E4E8>});</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>201</div></div><div class=code>
</div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>202</div></div><div class=code><span class=indent>      </span><span style=--0:#99A0A6>// Initial load: try client cache then network. Start auto refresh interval.</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>203</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>      </span></span><span style=--0:#E1E4E8>(</span><span style=--0:#F97583>async</span><span style=--0:#E1E4E8> () </span><span style=--0:#F97583>=></span><span style=--0:#E1E4E8> {</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>204</div></div><div class=code><span class=indent>        </span><span style=--0:#F97583>const</span><span style=--0:#E1E4E8> </span><span style=--0:#79B8FF>clientCached</span><span style=--0:#E1E4E8> </span><span style=--0:#F97583>=</span><span style=--0:#E1E4E8> </span><span style=--0:#B392F0>readClientCache</span><span style=--0:#E1E4E8>();</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>205</div></div><div class=code><span class=indent>        </span><span style=--0:#F97583>if</span><span style=--0:#E1E4E8> (clientCached) {</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>206</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>          </span></span><span style=--0:#E1E4E8>dataStore </span><span style=--0:#F97583>=</span><span style=--0:#E1E4E8> clientCached;</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>207</div></div><div class=code><span class=indent>          </span><span style=--0:#B392F0>renderCurrent</span><span style=--0:#E1E4E8>();</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>208</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>        </span></span><span style=--0:#E1E4E8>} </span><span style=--0:#F97583>else</span><span style=--0:#E1E4E8> {</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>209</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>          </span></span><span style=--0:#E1E4E8>contentArea.innerHTML </span><span style=--0:#F97583>=</span><span style=--0:#E1E4E8> </span><span style=--0:#9ECBFF>'&#x3C;div class="col-span-full text-center py-12 text-sm text-gray-500">Loading...&#x3C;/div>'</span><span style=--0:#E1E4E8>;</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>210</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>        </span></span><span style=--0:#E1E4E8>}</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>211</div></div><div class=code>
</div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>212</div></div><div class=code><span class=indent>        </span><span style=--0:#F97583>await</span><span style=--0:#E1E4E8> </span><span style=--0:#B392F0>fetchFromApi</span><span style=--0:#E1E4E8>(</span><span style=--0:#79B8FF>false</span><span style=--0:#E1E4E8>); </span><span style=--0:#99A0A6>// fetch fresh in background (updates UI when done)</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>213</div></div><div class=code>
</div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>214</div></div><div class=code><span class=indent>        </span><span style=--0:#99A0A6>// auto refresh periodically</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>215</div></div><div class=code><span class=indent>        </span><span style=--0:#B392F0>setInterval</span><span style=--0:#E1E4E8>(() </span><span style=--0:#F97583>=></span><span style=--0:#E1E4E8> {</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>216</div></div><div class=code><span class=indent>          </span><span style=--0:#B392F0>fetchFromApi</span><span style=--0:#E1E4E8>(</span><span style=--0:#79B8FF>false</span><span style=--0:#E1E4E8>);</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>217</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>        </span></span><span style=--0:#E1E4E8>}, </span><span style=--0:#79B8FF>AUTO_REFRESH_MS</span><span style=--0:#E1E4E8>);</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>218</div></div><div class=code>
</div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>219</div></div><div class=code><span class=indent>        </span><span style=--0:#99A0A6>// default active tab</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>220</div></div><div class=code><span class=indent>        </span><span style=--0:#B392F0>setActiveTab</span><span style=--0:#E1E4E8>(</span><span style=--0:#9ECBFF>"watching"</span><span style=--0:#E1E4E8>);</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>221</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>      </span></span><span style=--0:#E1E4E8>})();</span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>222</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>    </span></span><span style=--0:#E1E4E8>&#x3C;/</span><span style=--0:#85E89D>script</span><span style=--0:#E1E4E8>></span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>223</div></div><div class=code><span class=indent><span style=--0:#E1E4E8>  </span></span><span style=--0:#E1E4E8>&#x3C;/</span><span style=--0:#FDAEB7;--0fs:italic>MainCard</span><span style=--0:#E1E4E8>></span></div></div><div class=ec-line><div class=gutter><div class=ln aria-hidden=true>224</div></div><div class=code><span style=--0:#E1E4E8>&#x3C;/</span><span style=--0:#FDAEB7;--0fs:italic>BaseLayout</span><span style=--0:#E1E4E8>></span></div></div></code></pre><div class=copy><button title="Copy to clipboard" data-code="---import BaseLayout from &#x22;@/layouts/BaseLayout.astro&#x22;;import MainCard from &#x22;@/components/MainCard.astro&#x22;;import { Icon } from &#x22;astro-icon/components&#x22;;<!--这里是博客的基本配置，不用管-->type Subject = {  id: number;  name: string;  name_cn?: string;  date?: string;  images?: { common?: string };};type WatchingItem = { subject: Subject };// remove server-side fetching so page is static-built and client will update---<BaseLayout title=&#x22;我的追番&#x22;>  <MainCard title=&#x22;Anime&#x22; description=&#x22;追番记录&#x22; textOverlay=&#x22;Anime&#x22; infoIcon=&#x22;lucide:tv&#x22;>    <div class=&#x22;space-y-4 mb-8 max-w-7xl mx-auto px-4&#x22;>      <div class=&#x22;flex flex-col md:flex-row items-center justify-between gap-4&#x22;>        <input          type=&#x22;text&#x22;          id=&#x22;search&#x22;          placeholder=&#x22;搜索番剧...&#x22;          class=&#x22;px-4 py-2 w-full md:w-64 rounded-full border border-gray-300 focus:border-blue-600 focus:ring-2 focus:ring-blue-200 outline-none transition&#x22;        />        <div class=&#x22;flex items-center gap-2&#x22;>          <div class=&#x22;flex gap-2&#x22; id=&#x22;tab-group&#x22;>            <button              data-tab=&#x22;watching&#x22;              class=&#x22;tab-btn px-4 py-2 rounded-full bg-blue-600 text-white font-semibold shadow&#x22;            >              在看            </button>            <button data-tab=&#x22;wish&#x22; class=&#x22;tab-btn px-4 py-2 rounded-full bg-gray-200 text-gray-700 font-semibold&#x22;>              想看            </button>            <button data-tab=&#x22;watched&#x22; class=&#x22;tab-btn px-4 py-2 rounded-full bg-gray-200 text-gray-700 font-semibold&#x22;>              看过            </button>          </div>          <button            id=&#x22;refresh-btn&#x22;            title=&#x22;手动刷新&#x22;            class=&#x22;px-4 py-2 rounded-full bg-gray-200 text-gray-700 font-semibold&#x22;          >            刷新          </button>        </div>      </div>      <!-- 内容容器：初始为空，客户端填充 -->      <div id=&#x22;content-area&#x22; class=&#x22;grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-6&#x22;>        <div id=&#x22;loading-placeholder&#x22; class=&#x22;col-span-full text-center py-12 text-sm text-gray-500&#x22;>Loading...</div>      </div>    </div>    <script type=&#x22;module&#x22;>      const API = &#x22;/api/bangumi&#x22;;      const CACHE_KEY = &#x22;bangumi_front_cache_v1&#x22;;      const CLIENT_TTL = 60 * 60 * 1000; // 1 hour client-side fallback cache      const AUTO_REFRESH_MS = 15 * 60 * 1000; // auto refresh every 15 minutes      const tabs = [&#x22;watching&#x22;, &#x22;wish&#x22;, &#x22;watched&#x22;];      let currentTab = &#x22;watching&#x22;;      let dataStore = { watching: [], wish: [], watched: [] };      const searchInput = document.getElementById(&#x22;search&#x22;);      const contentArea = document.getElementById(&#x22;content-area&#x22;);      const refreshBtn = document.getElementById(&#x22;refresh-btn&#x22;);      function saveClientCache(obj) {        try {          localStorage.setItem(CACHE_KEY, JSON.stringify({ data: obj, ts: Date.now() }));        } catch (e) {          /* ignore */        }      }      function readClientCache() {        try {          const raw = localStorage.getItem(CACHE_KEY);          if (!raw) return null;          const parsed = JSON.parse(raw);          if (Date.now() - parsed.ts > CLIENT_TTL) return null;          return parsed.data;        } catch {          return null;        }      }      async function fetchFromApi(force = false) {        // If not forced, try client cache first        if (!force) {          const cached = readClientCache();          if (cached) {            dataStore = cached;            renderCurrent();            // still refresh in background if staled? we&#x27;ll continue to fetch but don&#x27;t block UI          }        }        try {          // Add cache-busting param and optional force flag so server bypasses cache          const url = &#x60;${API}?t=${Date.now()}${force ? &#x22;&#x26;force=1&#x22; : &#x22;&#x22;}&#x60;;          const res = await fetch(url, { cache: &#x22;no-store&#x22; });          if (!res.ok) throw new Error(&#x22;fetch failed &#x22; + res.status);          const json = await res.json();          // server returns { watching, wish, watched, cachedAt }          dataStore = {            watching: json.watching || [],            wish: json.wish || [],            watched: json.watched || [],          };          saveClientCache(dataStore);          renderCurrent();          return true;        } catch (e) {          console.warn(&#x22;Bangumi API fetch failed:&#x22;, e);          // if nothing in UI (from cache) and client cache missing, show error          if (!dataStore.watching.length &#x26;&#x26; !dataStore.wish.length &#x26;&#x26; !dataStore.watched.length) {            contentArea.innerHTML =              &#x27;<div class=&#x22;col-span-full text-center py-8 text-sm text-red-500&#x22;>无法加载番剧数据，请稍后再试。</div>&#x27;;          }          return false;        }      }      function renderCard(item) {        const title = (item.subject.name_cn || item.subject.name || &#x22;&#x22;).replace(/&#x22;/g, &#x22;&#x26;quot;&#x22;);        const img = item.subject.images?.common;        const id = item.subject.id;        const date = item.subject.date ? &#x60;<p class=&#x22;text-xs text-gray-500 mb-2&#x22;>${item.subject.date}</p>&#x60; : &#x22;&#x22;;        return &#x60;          <div class=&#x22;card bg-white rounded-xl shadow hover:shadow-lg transform hover:-translate-y-1 transition overflow-hidden text-center&#x22; data-name=&#x22;${(title || &#x22;&#x22;).toLowerCase()}&#x22;>            ${img ? &#x60;<a href=&#x22;https://bgm.tv/subject/${id}&#x22; target=&#x22;_blank&#x22; rel=&#x22;noopener noreferrer&#x22;><img src=&#x22;${img}&#x22; alt=&#x22;${title}&#x22; class=&#x22;w-full h-48 md:h-56 lg:h-60 object-cover rounded-t-xl&#x22; loading=&#x22;lazy&#x22; /></a>&#x60; : &#x22;&#x22;}            <h3 class=&#x22;mt-2 text-sm font-medium truncate px-2&#x22;>${title}</h3>            ${date}          </div>        &#x60;;      }      function renderCurrent() {        const list = dataStore[currentTab] || [];        const term = (searchInput.value || &#x22;&#x22;).toLowerCase();        // Only show &#x27;no content&#x27; if data has been loaded and the list is empty.        // If dataStore is empty, it means we are still in the initial loading phase.        if (          list.length === 0 &#x26;&#x26;          (dataStore.watching.length > 0 || dataStore.wish.length > 0 || dataStore.watched.length > 0)        ) {          contentArea.innerHTML = &#x27;<div class=&#x22;col-span-full text-center py-8 text-sm text-gray-500&#x22;>暂无内容</div>&#x27;;          return;        }        if (list.length > 0) {          const html = list.map((item) => renderCard(item)).join(&#x22;&#x22;);          contentArea.innerHTML = html;        }        // apply search filter        if (term) {          const cards = contentArea.querySelectorAll(&#x22;[data-name]&#x22;);          cards.forEach((c) => {            const name = c.getAttribute(&#x22;data-name&#x22;) || &#x22;&#x22;;            c.classList.toggle(&#x22;hidden&#x22;, !name.includes(term));          });        }      }      // tabs UI: simple CSS class change and switching currentTab      function setActiveTab(tab) {        currentTab = tab;        // update button styles        document.querySelectorAll(&#x22;.tab-btn&#x22;).forEach((b) => {          if (b.dataset.tab === tab) {            b.classList.add(&#x22;bg-blue-600&#x22;, &#x22;text-white&#x22;, &#x22;shadow&#x22;);            b.classList.remove(&#x22;bg-gray-200&#x22;, &#x22;text-gray-700&#x22;);          } else {            b.classList.remove(&#x22;bg-blue-600&#x22;, &#x22;text-white&#x22;, &#x22;shadow&#x22;);            b.classList.add(&#x22;bg-gray-200&#x22;, &#x22;text-gray-700&#x22;);          }        });        renderCurrent();      }      // Attach tab buttons      document.querySelectorAll(&#x22;#tab-group .tab-btn&#x22;).forEach((b) => {        b.addEventListener(&#x22;click&#x22;, () => setActiveTab(b.dataset.tab));      });      // Search      searchInput.addEventListener(&#x22;input&#x22;, () => renderCurrent());      // Refresh button      refreshBtn.addEventListener(&#x22;click&#x22;, async () => {        refreshBtn.textContent = &#x22;刷新中…&#x22;;        refreshBtn.disabled = true;        await fetchFromApi(true);        refreshBtn.textContent = &#x22;刷新&#x22;;        refreshBtn.disabled = false;      });      // Initial load: try client cache then network. Start auto refresh interval.      (async () => {        const clientCached = readClientCache();        if (clientCached) {          dataStore = clientCached;          renderCurrent();        } else {          contentArea.innerHTML = &#x27;<div class=&#x22;col-span-full text-center py-12 text-sm text-gray-500&#x22;>Loading...</div>&#x27;;        }        await fetchFromApi(false); // fetch fresh in background (updates UI when done)        // auto refresh periodically        setInterval(() => {          fetchFromApi(false);        }, AUTO_REFRESH_MS);        // default active tab        setActiveTab(&#x22;watching&#x22;);      })();    </script>  </MainCard></BaseLayout>" data-copied=Copied!><div></div></button></div></figure></div><p>这就搭建好了追番页面，后续可以自行修改参数样式。</p><p>示例：<a href=http://www.duskydream.icu/anime rel=nofollow>www.duskydream.icu/anime<span>↗</span></a></p><hr data-astro-cid-zux26muy><div class="container p-0" data-astro-cid-zux26muy><div class="text-sm italic mb-2 text-base-content/60 text-right" data-astro-cid-zux26muy><svg height=1em width=1em data-icon=ri:heart-line class="h-4 w-4 align-text-bottom inline-block text-error" data-astro-cid-zux26muy=true><symbol id=ai:ri:heart-line viewBox="0 0 24 24"><path d="M12.001 4.529a6 6 0 0 1 8.242.228a6 6 0 0 1 .236 8.236l-8.48 8.492l-8.478-8.492a6 6 0 0 1 8.48-8.464m6.826 1.641a4 4 0 0 0-5.49-.153l-1.335 1.198l-1.336-1.197a4 4 0 0 0-5.686 5.605L12 18.654l7.02-7.03a4 4 0 0 0-.193-5.454" fill=currentColor /></symbol><use href=#ai:ri:heart-line></use></svg> Thanks for reading!</div><div class="bg-base-200 card overflow-visible" data-astro-cid-zux26muy><div class="relative p-4 card-body lg:p-8 sm:p-6" data-astro-cid-zux26muy><div class="absolute -top-8 left-8" data-astro-cid-zux26muy><div class="flex items-center justify-center bg-primary h-16 rounded-full shadow-lg w-16" data-astro-cid-zux26muy><svg height=1em width=1em data-icon=ri:creative-commons-line class="h-10 text-primary-content w-10" data-astro-cid-zux26muy=true><symbol id=ai:ri:creative-commons-line viewBox="0 0 24 24"><path d="M9 8c1.104 0 2.105.448 2.829 1.173l-1.414 1.413a2 2 0 1 0 0 2.828l1.413 1.414A4.001 4.001 0 0 1 5 12c0-2.208 1.792-4 4-4m9.829 1.173A4.001 4.001 0 0 0 12 12a4.001 4.001 0 0 0 6.828 2.828l-1.414-1.414a2 2 0 1 1 0-2.828zM2 12C2 6.477 6.477 2 12 2s10 4.477 10 10s-4.477 10-10 10S2 17.523 2 12m10-8a8 8 0 1 0 0 16a8 8 0 0 0 0-16" fill=currentColor /></symbol><use href=#ai:ri:creative-commons-line></use></svg></div></div><div class=space-y-4 data-astro-cid-zux26muy><h3 class="sm:text-xl font-bold text-lg lg:text-2xl" data-astro-cid-zux26muy>通过调用API实现博客追番页面</h3><div class="flex flex-wrap gap-2 opacity-75 sm:gap-4 sm:text-sm text-xs" data-astro-cid-zux26muy><span class="flex items-center gap-1" data-astro-cid-zux26muy><svg height=1em width=1em data-icon=lucide:calendar class="h-4 w-4" viewBox="0 0 24 24" data-astro-cid-zux26muy=true><use href=#ai:lucide:calendar></use></svg> 周五 10月 03 2025</span><div class="flex items-center gap-1" data-astro-cid-zux26muy><svg height=1em width=1em data-icon=lucide:book-open class="h-4 w-4" viewBox="0 0 24 24" data-astro-cid-zux26muy=true><use href=#ai:lucide:book-open></use></svg> <span data-astro-cid-zux26muy>1422 字 · 14 分钟</span></div><a href=https://duskydream.icu/bangumi class="flex items-center gap-1 hover:text-primary transition-colors" data-astro-cid-zux26muy><svg height=1em width=1em data-icon=ri:links-line class="h-4 w-4" data-astro-cid-zux26muy=true><symbol id=ai:ri:links-line viewBox="0 0 24 24"><path d="m13.06 8.111l1.415 1.414a7 7 0 0 1 0 9.9l-.354.353a7 7 0 1 1-9.9-9.9l1.415 1.415a5 5 0 1 0 7.071 7.071l.354-.354a5 5 0 0 0 0-7.07l-1.415-1.415zm6.718 6.01l-1.414-1.414a5 5 0 0 0-7.071-7.07l-.354.353a5 5 0 0 0 0 7.07l1.415 1.415l-1.415 1.414l-1.414-1.414a7 7 0 0 1 0-9.9l.354-.353a7 7 0 1 1 9.9 9.9" fill=currentColor /></symbol><use href=#ai:ri:links-line></use></svg></a></div><div class=mt-4 data-astro-cid-zux26muy><div class="flex items-center flex-wrap gap-2"><a href=/blog/category/FrontendDeveloping class="btn btn-xs btn-category"><svg height=1em width=1em data-icon=lucide:folder class="h-4 w-4" viewBox="0 0 24 24"><use href=#ai:lucide:folder></use></svg> <span>FrontendDeveloping</span> </a><a href=/blog/tag/Anime class="btn btn-xs btn-tag"><svg height=1em width=1em data-icon=lucide:tag class="h-4 w-4" viewBox="0 0 24 24"><use href=#ai:lucide:tag></use></svg> <span>Anime</span></a></div><hr data-astro-cid-zux26muy class=my-4><p class="text-sm opacity-75" data-astro-cid-zux26muy></p>© Shepherd Meng | <a href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed class="hover:text-primary transition-colors" target=_blank data-astro-cid-zux26muy rel="noopener noreferrer">CC BY-NC-SA 4.0</a></div></div><div class="flex justify-end mt-4" data-astro-cid-zux26muy><button class="btn btn-outline btn-primary" data-astro-cid-zux26muy onclick=share_modal.showModal()>分享 <svg height=1em width=1em data-icon=ri:share-line class="h-5 w-5" data-astro-cid-zux26muy=true><symbol id=ai:ri:share-line viewBox="0 0 24 24"><path d="m13.12 17.023l-4.199-2.29a4 4 0 1 1 0-5.465l4.2-2.29a4 4 0 1 1 .958 1.755l-4.2 2.29a4 4 0 0 1 0 1.954l4.2 2.29a4 4 0 1 1-.959 1.755M6 14a2 2 0 1 0 0-4a2 2 0 0 0 0 4m11-6a2 2 0 1 0 0-4a2 2 0 0 0 0 4m0 12a2 2 0 1 0 0-4a2 2 0 0 0 0 4" fill=currentColor /></symbol><use href=#ai:ri:share-line></use></svg></button></div></div></div><dialog class="modal modal-bottom sm:modal-middle" id=share_modal data-astro-cid-zux26muy><div class="modal-box max-w-2xl rounded-none sm:rounded-xl" data-astro-cid-zux26muy><h3 class="mb-6 font-bold sm:text-xl text-center text-lg" data-astro-cid-zux26muy>分享这篇博客</h3><div class="flex justify-center gap-4 flex-wrap" data-astro-cid-zux26muy><a href="https://twitter.com/intent/tweet/?text=通过调用API实现博客追番页面&url=https://duskydream.icu/bangumi" class="btn btn-circle hover:scale-110 btn-lg transition-transform bg-black hover:bg-gray-800" target=_blank data-astro-cid-zux26muy rel="noopener noreferrer" title="X (Twitter)"><span class=sr-only data-astro-cid-zux26muy>X (Twitter)</span> <svg height=1em width=1em data-icon=ri:twitter-x-line class="text-white h-6 w-6" data-astro-cid-zux26muy=true><symbol id=ai:ri:twitter-x-line viewBox="0 0 24 24"><path d="M10.488 14.651L15.25 21h7l-7.858-10.478L20.93 3h-2.65l-5.117 5.886L8.75 3h-7l7.51 10.015L2.32 21h2.65zM16.25 19L5.75 5h2l10.5 14z" fill=currentColor /></symbol><use href=#ai:ri:twitter-x-line></use></svg> </a><a href="https://telegram.me/share/url?text=通过调用API实现博客追番页面&url=https://duskydream.icu/bangumi" class="btn btn-circle hover:scale-110 btn-lg transition-transform bg-[#26a5e4] hover:bg-[#1e96d1]" target=_blank data-astro-cid-zux26muy rel="noopener noreferrer" title=Telegram><span class=sr-only data-astro-cid-zux26muy>Telegram</span> <svg height=1em width=1em data-icon=ri:telegram-line class="text-white h-6 w-6" data-astro-cid-zux26muy=true><symbol id=ai:ri:telegram-line viewBox="0 0 24 24"><path d="M20 12a8 8 0 1 1-16 0a8 8 0 0 1 16 0m-8 10c5.523 0 10-4.477 10-10S17.523 2 12 2S2 6.477 2 12s4.477 10 10 10m.358-12.618q-1.458.607-5.831 2.513q-.711.282-.744.552c-.038.304.343.424.862.587l.218.07c.51.166 1.198.36 1.555.368q.486.01 1.084-.4q4.086-2.76 4.218-2.789c.063-.014.149-.032.207.02c.059.052.053.15.047.177c-.038.161-1.534 1.552-2.308 2.271q-.344.324-.683.653c-.474.457-.83.8.02 1.36c.861.568 1.73 1.134 2.57 1.733c.414.296.786.56 1.246.519c.267-.025.543-.276.683-1.026c.332-1.77.983-5.608 1.133-7.19a1.8 1.8 0 0 0-.017-.393a.42.42 0 0 0-.142-.27c-.12-.098-.305-.118-.387-.117c-.376.007-.953.207-3.73 1.362" fill=currentColor /></symbol><use href=#ai:ri:telegram-line></use></svg> </a><a href="https://reddit.com/submit/?url=https://duskydream.icu/bangumi&title=通过调用API实现博客追番页面" class="btn btn-circle hover:scale-110 btn-lg transition-transform bg-[#ff4500] hover:bg-[#e63e00]" target=_blank data-astro-cid-zux26muy rel="noopener noreferrer" title=Reddit><span class=sr-only data-astro-cid-zux26muy>Reddit</span> <svg height=1em width=1em data-icon=ri:reddit-line class="text-white h-6 w-6" data-astro-cid-zux26muy=true><symbol id=ai:ri:reddit-line viewBox="0 0 24 24"><path d="m11.053 7.815l.751-3.536a2 2 0 0 1 2.372-1.54l3.196.68a2 2 0 1 1-.415 1.956l-3.197-.68l-.666 3.135c1.785.137 3.558.73 5.164 1.7A3.192 3.192 0 0 1 23 12.203v.021a3.2 3.2 0 0 1-1.207 2.55l-.008.123c0 3.998-4.45 7.03-9.799 7.03c-5.333 0-9.708-3.024-9.705-6.953l-.01-.181a3.193 3.193 0 0 1 3.454-5.35a11.45 11.45 0 0 1 5.329-1.628m9.285 5.526a1.19 1.19 0 0 0 .662-1.075a1.192 1.192 0 0 0-2.016-.806l-.585.56l-.67-.455c-1.615-1.098-3.452-1.725-5.23-1.764h-1.006c-1.875.028-3.652.6-5.237 1.675l-.664.45l-.583-.55a1.192 1.192 0 1 0-1.315 1.952l.633.29l-.053.695a4 4 0 0 0 .003.584c0 2.71 3.356 5.03 7.708 5.03c4.371 0 7.799-2.336 7.802-5.107a3 3 0 0 0 0-.507l-.052-.672zM6.951 13.5a1.5 1.5 0 1 1 3 0a1.5 1.5 0 0 1-3 0m7 0a1.5 1.5 0 1 1 3 0a1.5 1.5 0 0 1-3 0m-1.985 5.103c-1.397 0-2.766-.37-3.881-1.21a.424.424 0 0 1 .597-.597c.945.693 2.123.99 3.269.99s2.33-.275 3.284-.959a.44.44 0 0 1 .732.206a.47.47 0 0 1-.12.423c-.683.797-2.483 1.147-3.88 1.147" fill=currentColor /></symbol><use href=#ai:ri:reddit-line></use></svg> </a><a href="https://facebook.com/sharer/sharer.php?u=https://duskydream.icu/bangumi" class="btn btn-circle hover:scale-110 btn-lg transition-transform bg-[#0866ff] hover:bg-[#0755d6]" target=_blank data-astro-cid-zux26muy rel="noopener noreferrer" title=Facebook><span class=sr-only data-astro-cid-zux26muy>Facebook</span> <svg height=1em width=1em data-icon=ri:facebook-circle-line class="text-white h-6 w-6" data-astro-cid-zux26muy=true><symbol id=ai:ri:facebook-circle-line viewBox="0 0 24 24"><path d="M13.001 19.938a8.001 8.001 0 0 0-1-15.938a8 8 0 0 0-1 15.938V14h-2v-2h2v-1.654c0-1.337.14-1.822.4-2.311A2.73 2.73 0 0 1 12.537 6.9c.382-.205.857-.328 1.687-.381q.494-.032 1.278.08v1.9h-.5c-.917 0-1.296.043-1.522.164a.73.73 0 0 0-.314.314c-.12.226-.164.45-.164 1.368V12h2.5l-.5 2h-2zm-1 2.062c-5.523 0-10-4.477-10-10s4.477-10 10-10s10 4.477 10 10s-4.477 10-10 10" fill=currentColor /></symbol><use href=#ai:ri:facebook-circle-line></use></svg> </a><a href="mailto:?subject=通过调用API实现博客追番页面&#38;body=https://duskydream.icu/bangumi" class="btn btn-circle hover:scale-110 btn-lg transition-transform bg-gray-600 hover:bg-gray-700" target=_blank data-astro-cid-zux26muy rel="noopener noreferrer" title=Email><span class=sr-only data-astro-cid-zux26muy>Email</span> <svg height=1em width=1em data-icon=ri:mail-line class="text-white h-6 w-6" data-astro-cid-zux26muy=true><symbol id=ai:ri:mail-line viewBox="0 0 24 24"><path d="M3 3h18a1 1 0 0 1 1 1v16a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1m17 4.238l-7.928 7.1L4 7.216V19h16zM4.511 5l7.55 6.662L19.502 5z" fill=currentColor /></symbol><use href=#ai:ri:mail-line></use></svg></a></div><div class=modal-action data-astro-cid-zux26muy><form method=dialog data-astro-cid-zux26muy><button class="btn transition-transform btn-ghost hover:scale-105" data-astro-cid-zux26muy>关闭</button></form></div></div><form method=dialog class=modal-backdrop data-astro-cid-zux26muy><button data-astro-cid-zux26muy>关闭</button></form></dialog></div></div></div></div></div><script type=module>document.addEventListener("astro:page-load",(()=>{const t=document.querySelectorAll(".dropdown label"),e=document.querySelectorAll(".dropdown-content");t.forEach(((t,a)=>{t.addEventListener("click",(()=>{const t=e[a];"closed"===t.getAttribute("data-state")?(t.setAttribute("data-state","open"),t.classList.add("scale-100","opacity-100"),t.classList.remove("scale-90","opacity-0")):(t.setAttribute("data-state","closed"),t.classList.add("scale-90","opacity-0"),t.classList.remove("scale-100","opacity-100"))}))}))}))</script><div class=mt-12 id=comments><script src=https://giscus.app/client.js async crossorigin=anonymous data-category=General data-category-id=DIC_kwDOP0om7c4Cv4dH data-emit-metadata=0 data-input-position=bottom data-lang=zh-CN data-loading=lazy data-mapping=pathname data-reactions-enabled=1 data-repo=Duskydream/ShepherdsBlog data-repo-id=R_kgDOP0om7Q data-strict=0 data-theme=light_tritanopia></script><noscript>请开启 JavaScript 以查看评论。</noscript></div><script>document.addEventListener("astro:page-load",(()=>{const t=document.querySelector("iframe.giscus-frame");if(!t)return;const e=e=>{t.contentWindow.postMessage({giscus:{setConfig:{theme:e}}},"https://giscus.app")},a=document.documentElement,r=a.getAttribute("data-theme-type");e("dark"===r?"dark":"light");new MutationObserver((t=>{t.forEach((t=>{if("data-theme-type"===t.attributeName){const t=a.getAttribute("data-theme-type");e("dark"===t?"dark":"light")}}))})).observe(a,{attributes:!0})}))</script></main><aside class=col-span-1><div class="relative mb-4"><div class="w-full bg-base-100 shadow-lg rounded-xl"><div class="flex flex-col p-4 relative"><div class="flex justify-center p-2"><img alt=Profile class="mask mask-circle" src=https://pic1.imgdb.cn/item/65c1c9269f345e8d03080e8d.jpg decoding=async fetchpriority=auto height=250 loading=eager width=250></div><ul class="items-center w-full bg-transparent flex-col hidden lg:items-start m-0 md:flex menu p-0"><li class="relative w-full group"><a href=/about class="flex items-center rounded-lg hover:bg-base-200 font-bold justify-center lg:justify-start lg:text-xl md:text-3xl p-4 text-center text-xl" target=_self aria-label=About tabindex=0 id=about><svg height=1em width=1em data-icon=material-symbols:info-outline-rounded viewBox="0 0 24 24"><use href=#ai:material-symbols:info-outline-rounded></use></svg> <span class="hidden lg:inline ml-2">About</span></a></li><li class="relative w-full group"><a href=/blog class="flex items-center rounded-lg hover:bg-base-200 font-bold justify-center lg:justify-start lg:text-xl md:text-3xl p-4 text-center text-xl" target=_self aria-label=Blogs tabindex=0 id=blog><svg height=1em width=1em data-icon=material-symbols:book-2-outline-rounded viewBox="0 0 24 24"><use href=#ai:material-symbols:book-2-outline-rounded></use></svg> <span class="hidden lg:inline ml-2">Blogs</span></a></li><li class="relative w-full group"><a href=/log class="flex items-center rounded-lg hover:bg-base-200 font-bold justify-center lg:justify-start lg:text-xl md:text-3xl p-4 text-center text-xl" target=_self aria-label=Log tabindex=0 id=log><svg height=1em width=1em data-icon=material-symbols:calendar-clock-outline-rounded viewBox="0 0 24 24"><use href=#ai:material-symbols:calendar-clock-outline-rounded></use></svg> <span class="hidden lg:inline ml-2">Log</span></a></li><li class="relative w-full group"><a href=/friend class="flex items-center rounded-lg hover:bg-base-200 font-bold justify-center lg:justify-start lg:text-xl md:text-3xl p-4 text-center text-xl" target=_self aria-label=Friends tabindex=0 id=friend><svg height=1em width=1em data-icon=material-symbols:supervisor-account-outline-rounded viewBox="0 0 24 24"><use href=#ai:material-symbols:supervisor-account-outline-rounded></use></svg> <span class="hidden lg:inline ml-2">Friends</span></a></li><li class="relative w-full group"><details class="w-full menu-item" data-submenu-id=my><summary class="items-center rounded-lg hover:bg-base-200 font-bold justify-center lg:justify-start lg:text-xl md:text-3xl p-4 text-center text-xl"><svg height=1em width=1em data-icon=material-symbols:person-outline-rounded viewBox="0 0 24 24"><use href=#ai:material-symbols:person-outline-rounded></use></svg> <span class="hidden lg:inline ml-2">My</span></summary><ul class=rounded-lg><li class=relative><a href=/anime class="menu-item font-bold hover:bg-base-200 lg:text-base md:text-2xl p-2 rounded-lg text-base" target=_self aria-label=Anime tabindex=0 id=header-anime><svg height=1em width=1em data-icon=material-symbols:live-tv-rounded viewBox="0 0 24 24"><use href=#ai:material-symbols:live-tv-rounded></use></svg> <span class="hidden lg:inline ml-2">Anime</span></a></li></ul></details></li><li class="relative w-full group"><details class="w-full menu-item" data-submenu-id=link><summary class="items-center rounded-lg hover:bg-base-200 font-bold justify-center lg:justify-start lg:text-xl md:text-3xl p-4 text-center text-xl"><svg height=1em width=1em data-icon=material-symbols:add-link viewBox="0 0 24 24"><use href=#ai:material-symbols:add-link></use></svg> <span class="hidden lg:inline ml-2">Links</span></summary><ul class=rounded-lg><li class=relative><a href=https://chatgpt.com/ class="menu-item font-bold hover:bg-base-200 lg:text-base md:text-2xl p-2 rounded-lg text-base" target=_blank aria-label=ChatGPT tabindex=0 id=header-ChatGPT><svg height=1em width=1em data-icon=ri:openai-fill viewBox="0 0 24 24"><use href=#ai:ri:openai-fill></use></svg> <span class="hidden lg:inline ml-2">ChatGPT</span></a></li><li class=relative><a href=https://gemini.google.com/ class="menu-item font-bold hover:bg-base-200 lg:text-base md:text-2xl p-2 rounded-lg text-base" target=_blank aria-label="Google Gemini" tabindex=0 id="header-Google Gemini"><svg height=1em width=1em data-icon=ri:gemini-fill viewBox="0 0 24 24"><use href=#ai:ri:gemini-fill></use></svg> <span class="hidden lg:inline ml-2">Google Gemini</span></a></li></ul></details></li></ul><div class="mt-4 border-base-content/20 border-t pt-3"><div class="grid gap-2 grid-cols-4 justify-items-center lg:grid-cols-4 md:grid-cols-2"><div class="tooltip tooltip-bottom" data-tip=Github><a href=https://github.com/Duskydream class="btn btn-circle btn-ghost" target=_blank aria-label=Github tabindex=0><svg height=1em width=1em data-icon=ri:github-line class=text-xl><symbol id=ai:ri:github-line viewBox="0 0 24 24"><path d="M5.884 18.653c-.3-.2-.558-.455-.86-.816a51 51 0 0 1-.466-.579c-.463-.575-.755-.841-1.056-.95a1 1 0 1 1 .675-1.882c.752.27 1.261.735 1.947 1.588c-.094-.117.34.427.433.539c.19.227.33.365.44.438c.204.137.588.196 1.15.14c.024-.382.094-.753.202-1.095c-2.968-.726-4.648-2.64-4.648-6.396c0-1.24.37-2.356 1.058-3.292c-.218-.894-.185-1.975.302-3.192a1 1 0 0 1 .63-.582c.081-.024.127-.035.208-.047c.803-.124 1.937.17 3.415 1.096a11.7 11.7 0 0 1 2.687-.308c.912 0 1.819.104 2.684.308c1.477-.933 2.614-1.227 3.422-1.096q.128.02.218.05a1 1 0 0 1 .616.58c.487 1.216.52 2.296.302 3.19c.691.936 1.058 2.045 1.058 3.293c0 3.757-1.674 5.665-4.642 6.392c.125.415.19.878.19 1.38c0 .665-.002 1.299-.007 2.01c0 .19-.002.394-.005.706a1 1 0 0 1-.018 1.958c-1.14.227-1.984-.532-1.984-1.525l.002-.447l.005-.705c.005-.707.008-1.337.008-1.997c0-.697-.184-1.152-.426-1.361c-.661-.57-.326-1.654.541-1.751c2.966-.333 4.336-1.482 4.336-4.66c0-.955-.312-1.744-.913-2.404A1 1 0 0 1 17.2 6.19c.166-.414.236-.957.095-1.614l-.01.003c-.491.139-1.11.44-1.858.949a1 1 0 0 1-.833.135a9.6 9.6 0 0 0-2.592-.349c-.89 0-1.772.118-2.592.35a1 1 0 0 1-.829-.134c-.753-.507-1.374-.807-1.87-.947c-.143.653-.072 1.194.093 1.607a1 1 0 0 1-.189 1.045c-.597.655-.913 1.458-.913 2.404c0 3.172 1.371 4.328 4.322 4.66c.865.097 1.202 1.177.545 1.748c-.193.168-.43.732-.43 1.364v3.15c0 .985-.834 1.725-1.96 1.528a1 1 0 0 1-.04-1.962v-.99c-.91.061-1.661-.088-2.254-.485" fill=currentColor /></symbol><use href=#ai:ri:github-line></use></svg></a></div><div class="tooltip tooltip-bottom" data-tip=BiliBili><a href=https://space.bilibili.com/198625051 class="btn btn-circle btn-ghost" target=_blank aria-label=BiliBili tabindex=0><svg height=1em width=1em data-icon=ri:bilibili-line class=text-xl><symbol id=ai:ri:bilibili-line viewBox="0 0 24 24"><path d="M7.172 2.757L10.414 6h3.171l3.243-3.242a1 1 0 1 1 1.415 1.415L16.414 6H18.5A3.5 3.5 0 0 1 22 9.5v8a3.5 3.5 0 0 1-3.5 3.5h-13A3.5 3.5 0 0 1 2 17.5v-8A3.5 3.5 0 0 1 5.5 6h2.085L5.757 4.171a1 1 0 0 1 1.415-1.415M18.5 8h-13a1.5 1.5 0 0 0-1.493 1.356L4 9.5v8a1.5 1.5 0 0 0 1.356 1.493L5.5 19h13a1.5 1.5 0 0 0 1.493-1.355L20 17.5v-8A1.5 1.5 0 0 0 18.5 8M8 11a1 1 0 0 1 1 1v2a1 1 0 1 1-2 0v-2a1 1 0 0 1 1-1m8 0a1 1 0 0 1 1 1v2a1 1 0 1 1-2 0v-2a1 1 0 0 1 1-1" fill=currentColor /></symbol><use href=#ai:ri:bilibili-line></use></svg></a></div><div class="tooltip tooltip-bottom" data-tip=X(twitter)><a href=https://x.com/Lxzm1211 class="btn btn-circle btn-ghost" target=_blank aria-label=X(twitter) tabindex=0><svg height=1em width=1em data-icon=ri:twitter-x-fill class=text-xl><symbol id=ai:ri:twitter-x-fill viewBox="0 0 24 24"><path d="m17.687 3.063l-4.996 5.711l-4.32-5.711H2.112l7.477 9.776l-7.086 8.099h3.034l5.469-6.25l4.78 6.25h6.102l-7.794-10.304l6.625-7.571zm-1.064 16.06L5.654 4.782h1.803l10.846 14.34z" fill=currentColor /></symbol><use href=#ai:ri:twitter-x-fill></use></svg></a></div></div></div></div></div></div><div class="relative mb-4"><div class="w-full bg-base-100 shadow-lg rounded-xl"><div class=p-4><form method=get class="relative w-full" action=/blog/search><div class="relative w-full search-container"><input type=text aria-label=搜索 class="w-full input input-bordered pl-10 pr-16 py-2" name=q placeholder=搜索><div class="flex items-center absolute inset-y-0 left-0 pl-3 pointer-events-none"><svg height=1em width=1em data-icon=lucide:search class="h-5 w-5"><symbol id=ai:lucide:search viewBox="0 0 24 24"><g fill=none stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2><path d="m21 21l-4.34-4.34"/><circle cx=11 cy=11 r=8 /></g></symbol><use href=#ai:lucide:search></use></svg></div><button class="absolute transform -translate-y-1/2 p-2 right-2 top-1/2" aria-label=搜索 type=submit><svg height=1em width=1em data-icon=lucide:arrow-right class="h-4 w-4"><symbol id=ai:lucide:arrow-right viewBox="0 0 24 24"><path d="M5 12h14m-7-7l7 7l-7 7" fill=none stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 /></symbol><use href=#ai:lucide:arrow-right></use></svg></button></div></form></div></div><script type=module>document.addEventListener("keydown",(e=>{const t=e.target;if("/"===e.key&&t&&"INPUT"!==t.tagName&&"TEXTAREA"!==t.tagName){e.preventDefault();const t=document.querySelector('input[name="q"]');t&&t.focus()}}))</script></div><div class="md:sticky md:top-4"><div class="w-full bg-base-100 shadow-lg rounded-xl"><div class="toolbar-container p-4"><div class="flex items-center justify-center gap-4"><button class="btn btn-circle hover:scale-110 bg-base-100 btn-md md:border-base-content/20 shadow-sm sidebar-theme" aria-label="Toggle theme" id=theme-toggle-d6t0vvnol data-astro-cid-mjqc4hpp data-theme-toggle title=主题切换><svg height=1em width=1em data-icon=lucide:sun class="h-5 w-5 theme-toggle-icon sun-icon" viewBox="0 0 24 24" data-astro-cid-mjqc4hpp=true><use href=#ai:lucide:sun></use></svg> <svg height=1em width=1em data-icon=lucide:moon class="h-5 w-5 theme-toggle-icon hidden moon-icon" viewBox="0 0 24 24" data-astro-cid-mjqc4hpp=true><use href=#ai:lucide:moon></use></svg></button><script>!function(){const e="autumn",t="black",n=(e,t)=>{if(!e)return;const n=e.querySelector(".sun-icon"),o=e.querySelector(".moon-icon");n&&o&&(t?(n.classList.remove("hidden"),o.classList.add("hidden")):(n.classList.add("hidden"),o.classList.remove("hidden")))};document.addEventListener("astro:page-load",(()=>{const o=document.getElementById("theme-toggle-d6t0vvnol");if(!o)return;const d=document.documentElement.getAttribute("data-theme");n(o,d===t),o.addEventListener("click",(()=>{const d=document.documentElement.getAttribute("data-theme")===e?t:e;o.classList.add("animate-spin-once"),document.documentElement.setAttribute("data-theme",d);const c=d===t?"dark":"light";document.documentElement.setAttribute("data-theme-type",c),localStorage.setItem("theme",d);document.querySelectorAll("[data-theme-toggle]").forEach((e=>{n(e,d===t)})),setTimeout((()=>{o.classList.remove("animate-spin-once")}),300)}))}))}()</script></div></div></div><button class="btn btn-circle hover:scale-110 bg-base-100 btn-md fixed invisible opacity-0 right-6 shadow-lg transition-all z-50 bottom-6" aria-label="Scroll to top" id=scroll-to-top><svg height=1em width=1em data-icon=material-symbols:arrow-upward-rounded class="h-5 w-5"><symbol id=ai:material-symbols:arrow-upward-rounded viewBox="0 0 24 24"><path d="m11 7.825l-4.9 4.9q-.3.3-.7.288t-.7-.313q-.275-.3-.288-.7t.288-.7l6.6-6.6q.15-.15.325-.212T12 4.425t.375.063t.325.212l6.6 6.6q.275.275.275.688t-.275.712q-.3.3-.712.3t-.713-.3L13 7.825V19q0 .425-.288.713T12 20t-.712-.288T11 19z" fill=currentColor /></symbol><use href=#ai:material-symbols:arrow-upward-rounded></use></svg></button><script type=module>document.addEventListener("astro:page-load",(()=>{const i=document.getElementById("scroll-to-top");if(i){const s=()=>{window.scrollY>300?(i.classList.remove("opacity-0","invisible"),i.classList.add("opacity-100","visible")):(i.classList.remove("opacity-100","visible"),i.classList.add("opacity-0","invisible"))};s(),window.addEventListener("scroll",s),i.addEventListener("click",(()=>{window.scrollTo({top:0,behavior:"smooth"})}))}}))</script><div class="mt-4 md:max-h-[calc(100vh-2rem)] z-10" id=toc-container data-astro-cid-ydxbofl4><div class="w-full bg-base-100 shadow-lg rounded-xl"><div class=p-4 data-astro-cid-ydxbofl4><nav class="relative max-h-[calc(100vh-200px)] overflow-y-auto scrollbar-none toc-nav" data-astro-cid-ydxbofl4><div class="absolute opacity-0 bg-primary/10 pointer-events-none rounded-lg shadow-sm z-0" id=active-indicator data-astro-cid-ydxbofl4></div><ul class="relative space-y-0 z-10" data-astro-cid-ydxbofl4><li data-astro-cid-ydxbofl4><a href=#heading-0 class="flex items-center rounded-lg px-2 py-2 relative toc-link font-medium" style=padding-left:12px data-astro-cid-ydxbofl4 data-heading-depth=1 data-heading-slug=通过调用bangumi-api实现博客追番页面 data-index=0><svg height=1em width=1em data-icon=tabler:chevron-right class="h-4 w-4 absolute duration-200 icon-indicator left-1 opacity-0 text-primary transition-all" data-astro-cid-ydxbofl4=true><symbol id=ai:tabler:chevron-right viewBox="0 0 24 24"><path d="m9 6l6 6l-6 6" fill=none stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 /></symbol><use href=#ai:tabler:chevron-right></use></svg><span class="transition-transform duration-200 link-text" data-astro-cid-ydxbofl4>通过调用Bangumi API实现博客追番页面</span></a></li><li data-astro-cid-ydxbofl4><a href=#heading-1 class="flex items-center rounded-lg px-2 py-2 relative toc-link" style=padding-left:28px data-astro-cid-ydxbofl4 data-heading-depth=2 data-heading-slug=功能 data-index=1><svg height=1em width=1em data-icon=tabler:chevron-right class="h-4 w-4 absolute duration-200 icon-indicator left-1 opacity-0 text-primary transition-all" viewBox="0 0 24 24" data-astro-cid-ydxbofl4=true><use href=#ai:tabler:chevron-right></use></svg><span class="transition-transform duration-200 link-text" data-astro-cid-ydxbofl4>功能：</span></a></li><li data-astro-cid-ydxbofl4><a href=#heading-2 class="flex items-center rounded-lg px-2 py-2 relative toc-link" style=padding-left:28px data-astro-cid-ydxbofl4 data-heading-depth=2 data-heading-slug=方法 data-index=2><svg height=1em width=1em data-icon=tabler:chevron-right class="h-4 w-4 absolute duration-200 icon-indicator left-1 opacity-0 text-primary transition-all" viewBox="0 0 24 24" data-astro-cid-ydxbofl4=true><use href=#ai:tabler:chevron-right></use></svg><span class="transition-transform duration-200 link-text" data-astro-cid-ydxbofl4>方法</span></a></li><li data-astro-cid-ydxbofl4><a href=#heading-3 class="flex items-center rounded-lg px-2 py-2 relative toc-link" style=padding-left:44px data-astro-cid-ydxbofl4 data-heading-depth=3 data-heading-slug=1注册bangumi账号 data-index=3><svg height=1em width=1em data-icon=tabler:chevron-right class="h-4 w-4 absolute duration-200 icon-indicator left-1 opacity-0 text-primary transition-all" viewBox="0 0 24 24" data-astro-cid-ydxbofl4=true><use href=#ai:tabler:chevron-right></use></svg><span class="transition-transform duration-200 link-text" data-astro-cid-ydxbofl4>1.注册Bangumi账号</span></a></li><li data-astro-cid-ydxbofl4><a href=#heading-4 class="flex items-center rounded-lg px-2 py-2 relative toc-link" style=padding-left:44px data-astro-cid-ydxbofl4 data-heading-depth=3 data-heading-slug=2页面搭建以astro为例 data-index=4><svg height=1em width=1em data-icon=tabler:chevron-right class="h-4 w-4 absolute duration-200 icon-indicator left-1 opacity-0 text-primary transition-all" viewBox="0 0 24 24" data-astro-cid-ydxbofl4=true><use href=#ai:tabler:chevron-right></use></svg><span class="transition-transform duration-200 link-text" data-astro-cid-ydxbofl4>2.页面搭建（以Astro为例）</span></a></li></ul></nav></div></div></div><script type=module>document.addEventListener("astro:page-load",(()=>{const t=document.querySelector(".toc-nav"),e=document.getElementById("active-indicator"),n=Array.from(document.querySelectorAll(".toc-nav a"));if(!t||!e||0===n.length)return;const o=document.querySelectorAll("h1[id], h2[id], h3[id], h4[id], h5[id], h6[id]");if(0===o.length)return;let i=null,r=!1,s=null;const c=new Map;function a(t,n=!0){if(!t)return;const o=parseInt(t.getAttribute("data-heading-depth")||"1");e.style.transition=n?"all 0.3s cubic-bezier(0.25, 0.1, 0.25, 1)":"opacity 0.3s ease-in-out",requestAnimationFrame((()=>{e.style.top=`${t.offsetTop}px`,e.style.height=`${t.offsetHeight}px`,e.style.opacity="1",e.style.left=16*(o-1)+"px",e.style.width=`calc(100% - ${16*(o-1)}px)`}))}function u(t,e){const n=t.getBoundingClientRect(),o=e.getBoundingClientRect();return n.top>=o.top&&n.bottom<=o.bottom}function l(e){i!==e&&(i&&i.classList.remove("active"),e.classList.add("active"),i=e,a(e),u(e,t)||function(e){if(u(e,t))return;const n=e.offsetTop,o=t.clientHeight,i=Math.max(0,n-o/2+e.offsetHeight/2);t.scrollTo({top:i,behavior:"smooth"})}(e))}n.forEach(((t,e)=>{const n=t.dataset.headingSlug;if(!n)return;const o=document.getElementById(n),i=`heading-${e}`;o&&o.id!==i&&(o.setAttribute("id",i),c.set(n,i),document.querySelectorAll(`a[href="#${n}"]:not(.toc-nav a)`).forEach((t=>t.setAttribute("href",`#${i}`))))})),t.addEventListener("click",(t=>{const e=t.target.closest("a");if(!e)return;t.preventDefault();const n=e.getAttribute("href")||"";if(!n||!n.startsWith("#"))return;const o=n.substring(1),i=document.getElementById(o);i&&(r=!0,l(e),i.scrollIntoView({behavior:"smooth"}),history.pushState(null,"",n),setTimeout((()=>{r=!1}),1e3))})),window.addEventListener("resize",(()=>{s&&clearTimeout(s),s=window.setTimeout((()=>{i&&a(i,!1)}),100)}),{passive:!0});const d=new IntersectionObserver((t=>{if(r)return;const e=t.filter((t=>t.isIntersecting));if(0===e.length)return;let n=e[0],o=1/0;for(const t of e){const e=Math.abs(t.boundingClientRect.top);e<o&&(o=e,n=t)}const s=n.target.getAttribute("id");if(!s)return;const c=document.querySelector(`.toc-nav a[href="#${s}"]`);c&&c!==i&&l(c)}),{rootMargin:"-50px 0px -75% 0px",threshold:[0,.25]});o.forEach((t=>d.observe(t))),setTimeout((()=>{const t=window.location.hash.substring(1),e=t?document.getElementById(t):o[0];if(e){const t=e.getAttribute("id");if(!t)return;const n=document.querySelector(`.toc-nav a[href="#${t}"]`);n&&l(n)}}),200),window.addEventListener("hashchange",(()=>{if(r)return;const t=window.location.hash.substring(1);if(t){if(r=!0,document.getElementById(t)){const e=document.querySelector(`.toc-nav a[href="#${t}"]`);e&&l(e)}setTimeout((()=>{r=!1}),1e3)}}))}))</script></div></aside></div></div><footer class="bg-base-100 shadow-lg rounded-xl footer p-10"><aside><svg height=50 width=50 class=fill-current viewBox="0 0 24 24" clip-rule=evenodd fill-rule=evenodd xmlns=http://www.w3.org/2000/svg><path d="M22.672 15.226l-2.432.811.841 2.515c.33 1.019-.209 2.127-1.23 2.456-1.15.325-2.148-.321-2.463-1.226l-.84-2.518-5.013 1.677.84 2.517c.391 1.203-.434 2.542-1.831 2.542-.88 0-1.601-.564-1.86-1.314l-.842-2.516-2.431.809c-1.135.328-2.145-.317-2.463-1.229-.329-1.018.211-2.127 1.231-2.456l2.432-.809-1.621-4.823-2.432.808c-1.355.384-2.558-.59-2.558-1.839 0-.817.509-1.582 1.327-1.846l2.433-.809-.842-2.515c-.33-1.02.211-2.129 1.232-2.458 1.02-.329 2.13.209 2.461 1.229l.842 2.515 5.011-1.677-.839-2.517c-.403-1.238.484-2.553 1.843-2.553.819 0 1.585.509 1.85 1.326l.841 2.517 2.431-.81c1.02-.33 2.131.211 2.461 1.229.332 1.018-.21 2.126-1.23 2.456l-2.433.809 1.622 4.823 2.433-.809c1.242-.401 2.557.484 2.557 1.838 0 .819-.51 1.583-1.328 1.847m-8.992-6.428l-5.01 1.675 1.619 4.828 5.011-1.674-1.62-4.829z"></path></svg><p>Powered by <a href=https://github.com/EveSunMaple/Frosti class=font-bold target=_blank>Frosti Template</a><br>Copyright © <a href=https://duskydream.icu class=font-bold target=_blank>Shepherd Meng</a> 2025 - All right reserved</p></aside><nav><span class=footer-title>Social</span><div class="gap-4 grid grid-flow-col"><div class=tooltip data-tip=Github><a href=https://github.com/Duskydream aria-label=Github tabindex=0><svg height=1em width=1em data-icon=ri:github-line class="md:text-xl text-2xl" viewBox="0 0 24 24"><use href=#ai:ri:github-line></use></svg></a></div><div class=tooltip data-tip=BiliBili><a href=https://space.bilibili.com/198625051 aria-label=BiliBili tabindex=0><svg height=1em width=1em data-icon=ri:bilibili-line class="md:text-xl text-2xl" viewBox="0 0 24 24"><use href=#ai:ri:bilibili-line></use></svg></a></div><div class=tooltip data-tip=X(twitter)><a href=https://x.com/Lxzm1211 aria-label=X(twitter) tabindex=0><svg height=1em width=1em data-icon=ri:twitter-x-fill class="md:text-xl text-2xl" viewBox="0 0 24 24"><use href=#ai:ri:twitter-x-fill></use></svg></a></div><div class=tooltip data-tip="RSS Feed"><a href=/rss.xml aria-label="RSS Feed" tabindex=0><svg height=1em width=1em data-icon=ri:rss-line class="md:text-xl text-2xl"><symbol id=ai:ri:rss-line viewBox="0 0 24 24"><path d="M3 17a4 4 0 0 1 4 4H3zm0-7c6.075 0 11 4.925 11 11h-2a9 9 0 0 0-9-9zm0-7c9.941 0 18 8.059 18 18h-2c0-8.837-7.163-16-16-16z" fill=currentColor /></symbol><use href=#ai:ri:rss-line></use></svg></a></div></div></nav></footer></div><button class="btn btn-circle hover:scale-110 bg-base-100 btn-md fixed invisible opacity-0 right-6 shadow-lg transition-all z-50 bottom-20 md:hidden" aria-label=目录 id=mobile-toc-button onclick=mobile_toc_modal.showModal()><svg height=1em width=1em data-icon=lucide:list class="h-5 w-5"><symbol id=ai:lucide:list viewBox="0 0 24 24"><path d="M3 5h.01M3 12h.01M3 19h.01M8 5h13M8 12h13M8 19h13" fill=none stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 /></symbol><use href=#ai:lucide:list></use></svg></button><dialog class="modal md:hidden" id=mobile_toc_modal><div class="bg-base-100 max-w-md modal-box rounded-lg shadow-xl w-10/12"><div class="flex items-center border-b border-base-200 justify-between pb-4"><h3 class=font-medium>目录</h3><form method=dialog><button class="btn btn-circle btn-ghost" aria-label=目录><svg height=1em width=1em data-icon=lucide:x class="h-5 w-5" viewBox="0 0 24 24"><use href=#ai:lucide:x></use></svg></button></form></div><div class="max-h-[70vh] overflow-auto pt-4"><ul class="menu-sm menu"><li class=my-1><a href=#通过调用bangumi-api实现博客追番页面 class="flex items-center rounded-lg hover:bg-base-200 mobile-toc-link transition-color" style=margin-left:0 data-mobile-heading-id=通过调用bangumi-api实现博客追番页面><span class="text-sm truncate">通过调用Bangumi API实现博客追番页面</span></a></li><li class=my-1><a href=#功能 class="flex items-center rounded-lg hover:bg-base-200 mobile-toc-link transition-color" style=margin-left:12px data-mobile-heading-id=功能><span class="text-sm truncate">功能：</span></a></li><li class=my-1><a href=#方法 class="flex items-center rounded-lg hover:bg-base-200 mobile-toc-link transition-color" style=margin-left:12px data-mobile-heading-id=方法><span class="text-sm truncate">方法</span></a></li><li class=my-1><a href=#1注册bangumi账号 class="flex items-center rounded-lg hover:bg-base-200 mobile-toc-link transition-color" style=margin-left:24px data-mobile-heading-id=1注册bangumi账号><span class="text-sm truncate">1.注册Bangumi账号</span></a></li><li class=my-1><a href=#2页面搭建以astro为例 class="flex items-center rounded-lg hover:bg-base-200 mobile-toc-link transition-color" style=margin-left:24px data-mobile-heading-id=2页面搭建以astro为例><span class="text-sm truncate">2.页面搭建（以Astro为例）</span></a></li></ul></div></div><form method=dialog class=modal-backdrop><button>close</button></form></dialog><script type=module>document.addEventListener("astro:page-load",(()=>{const e=document.getElementById("mobile-toc-button");if(!e)return;const t=document.querySelectorAll(".mobile-toc-link"),i=document.querySelectorAll("h1[id], h2[id], h3[id], h4[id], h5[id], h6[id]");let o=null;const l=()=>{o||(o=setTimeout((()=>{window.scrollY>300?(e.classList.remove("opacity-0","invisible"),e.classList.add("opacity-100","visible")):(e.classList.remove("opacity-100","visible"),e.classList.add("opacity-0","invisible")),t.length>0&&i.length>0&&s(),o=null}),100))},s=()=>{let e=null;for(let t=i.length-1;t>=0;t--){const o=i[t];if(o.getBoundingClientRect().top<=100){e=o.id;break}}t.forEach((t=>{t.getAttribute("data-mobile-heading-id")===e?t.classList.add("bg-primary/10","font-medium"):t.classList.remove("bg-primary/10","font-medium")}))};window.addEventListener("scroll",l,{passive:!0}),l(),document.addEventListener("astro:before-swap",(()=>{window.removeEventListener("scroll",l),o&&clearTimeout(o)}))}))</script><script>!function(){const t="black";document.addEventListener("astro:after-swap",(()=>{const e=localStorage.getItem("theme");e&&(document.documentElement.setAttribute("data-theme",e),document.documentElement.setAttribute("data-theme-type",e===t?"dark":"light"))}))}()</script><script>document.addEventListener("astro:page-load",(()=>{if(window.location.hash){const o=document.querySelector(window.location.hash);o&&o.scrollIntoView({behavior:"smooth"})}}))</script><script>document.addEventListener("astro:page-load",(()=>{document.querySelectorAll(".btn-copy").forEach((e=>{e.addEventListener("click",(async()=>{const o=e.closest(".frosti-code").querySelector("code").textContent,c=e.querySelector(".frosti-code-toolbar-copy-icon"),s=e.querySelector(".frosti-code-toolbar-copy-success");try{await navigator.clipboard.writeText(o),c.classList.add("hidden"),s.classList.remove("hidden"),e.classList.add("copy-success"),setTimeout((()=>{c.classList.remove("hidden"),s.classList.add("hidden"),e.classList.remove("copy-success")}),2e3)}catch(e){console.error("Failed to copy:",e)}}))}))}))</script><style>.btn-copy{position:relative;overflow:hidden}.copy-success{animation:pulse .5s ease-in-out}.frosti-code-toolbar-copy-success svg{color:#10b981}@keyframes pulse{0%{transform:scale(1)}50%{transform:scale(1.1)}100%{transform:scale(1)}}</style></div></body></html>