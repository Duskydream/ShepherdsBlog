---
import BaseLayout from "@/layouts/BaseLayout.astro";
import MainCard from "@/components/MainCard.astro";
import { Icon } from "astro-icon/components";
import { getCollection } from "astro:content";

const logs = await getCollection("log");
const sortedLogs = logs.sort(
  (a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime()
);
---

<BaseLayout title="Logs">
  <MainCard
    title="Logs"
    description="Personal timeline and updates"
    textOverlay="LOGS"
    infoIcon="lucide:book-open"
  >
    <div class="space-y-10 mb-8">
      <!-- 日志时间线 -->
      <section>
        <h2 class="text-2xl font-bold mb-6 flex items-center gap-2">
          <Icon name="lucide:clock" class="w-6 h-6 text-primary" />
          <span>Timeline</span>
        </h2>

        <div class="bg-base-200 rounded-xl p-6 overflow-x-auto">
          <div class="flex flex-col gap-8">
            {await Promise.all(
              sortedLogs.map(async (entry, i) => {
                const { Content } = await entry.render();
                return (
                  <div class="relative flex gap-4 pb-2">
                    <!-- 时间轴左侧序号 -->
                    <div class="flex flex-col items-center">
                      <div class="w-10 h-10 rounded-full bg-primary flex items-center justify-center text-primary-content text-xl">
                        {i + 1}
                      </div>
                      <div class="w-0.5 flex-1 bg-base-300 mt-2" />
                    </div>

                    <!-- 日志内容 -->
                    <div class="flex-1">
                      <div class="text-sm text-base-content/60 mb-1">
                        {entry.data.date.toISOString().slice(0, 10)}
                      </div>
                      <h3 class="text-lg font-bold">{entry.data.title}</h3>
                      <article class="prose max-w-none text-base-content/80 mt-2 line-clamp-3">
                        <Content />
                      </article>
                    </div>

                    <!-- 查看详情按钮 -->
                    <div class="flex items-start">
                      <a
                        href={`/log/${entry.slug}/`}
                        class="btn btn-sm btn-outline gap-2"
                      >
                        <Icon name="lucide:external-link" class="w-4 h-4" />
                        查看详情
                      </a>
                    </div>
                  </div>
                );
              })
            )}
          </div>
        </div>
      </section>
    </div>
  </MainCard>
</BaseLayout>
